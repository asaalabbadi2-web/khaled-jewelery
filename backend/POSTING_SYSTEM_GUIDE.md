# ูุธุงู ุงูุชุญูู ุจุงูุชุฑุญูู (Posting Control System)
## ุฏููู ุดุงูู

---

## ๐ ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ](#ุงูุชุซุจูุช-ูุงูุฅุนุฏุงุฏ)
3. [ููู ูุนูู ุงููุธุงู](#ููู-ูุนูู-ุงููุธุงู)
4. [API Endpoints](#api-endpoints)
5. [ุฃูุซูุฉ ุนูููุฉ](#ุฃูุซูุฉ-ุนูููุฉ)
6. [ุฃูุถู ุงูููุงุฑุณุงุช](#ุฃูุถู-ุงูููุงุฑุณุงุช)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

### ูุง ูู ูุธุงู ุงูุชุฑุญููุ

ูุธุงู ุงูุชุฑุญูู (Posting System) ูู ุขููุฉ ูุญุงุณุจูุฉ ุชูุตู ุจูู **ุฅูุดุงุก ุงููุนุงููุฉ** ู**ุงูุชุฃุซูุฑ ุนูู ุงูุญุณุงุจุงุช**.

### ููุงุฐุง ูุญุชุงุฌูุ

**ูุจู ูุธุงู ุงูุชุฑุญูู:**
```
ุฅูุดุงุก ูุงุชูุฑุฉ โ ุชุฃุซูุฑ ููุฑู ุนูู ุงูุญุณุงุจุงุช โ
```
- **ูุดููุฉ**: ูุง ูููู ุงููุฑุงุฌุนุฉ ูุจู ุงูุชุฃุซูุฑ
- **ูุดููุฉ**: ุตุนูุจุฉ ุงูุชุตุญูุญ ุจุนุฏ ุงูุญูุธ
- **ูุดููุฉ**: ูุง ุชูุฌุฏ ููุทุฉ ุชุญูู

**ุจุนุฏ ูุธุงู ุงูุชุฑุญูู:**
```
ุฅูุดุงุก ูุงุชูุฑุฉ โ ูุฑุงุฌุนุฉ โ ุงุนุชูุงุฏ โ ุชุฑุญูู โ ุชุฃุซูุฑ ุนูู ุงูุญุณุงุจุงุช โ
```
- โ ูุฑุงุฌุนุฉ ูุจู ุงูุชุฑุญูู
- โ ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุจู ุงูุชุฃุซูุฑ
- โ ููุทุฉ ุชุญูู ูุงุถุญุฉ
- โ ูุณุงุฑ ุชุฏููู ูุงูู

---

## ๐ง ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุณูุฑูุจุช ุงูุชุฑุญูู

```bash
cd backend
source venv/bin/activate
python add_posting_fields.py
```

ูุฐุง ุงูุณูุฑูุจุช ูุถูู ุงูุญููู ุงูุชุงููุฉ:

**ููููุงุชูุฑ (Invoice):**
- `is_posted` (Boolean): ูู ุชู ุชุฑุญูู ุงููุงุชูุฑุฉุ
- `posted_at` (DateTime): ูุชู ุชู ุงูุชุฑุญููุ
- `posted_by` (String): ูู ูุงู ุจุงูุชุฑุญููุ

**ูููููุฏ (JournalEntry):**
- `is_posted` (Boolean): ูู ุชู ุชุฑุญูู ุงูููุฏุ
- `posted_at` (DateTime): ูุชู ุชู ุงูุชุฑุญููุ
- `posted_by` (String): ูู ูุงู ุจุงูุชุฑุญููุ

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุชุซุจูุช

```bash
# ุงูุญุต ุฌุฏูู invoice
sqlite3 backend/app.db "PRAGMA table_info(invoice);" | grep posted

# ุงูุญุต ุฌุฏูู journal_entry
sqlite3 backend/app.db "PRAGMA table_info(journal_entry);" | grep posted
```

ูุฌุจ ุฃู ุชุฑู:
```
is_posted
posted_at
posted_by
```

---

## โ๏ธ ููู ูุนูู ุงููุธุงู

### ุฏูุฑุฉ ุญูุงุฉ ุงููุงุชูุฑุฉ

```
โโโโโโโโโโโโโโโโโโโ
โ  ุฅูุดุงุก ูุงุชูุฑุฉ   โ
โ  is_posted=0    โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ   ูุฑุงุฌุนุฉ       โ  โโโ ูููู ุงูุชุนุฏูู/ุงูุญุฐู
โ   ูุชุฏููู       โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ุชุฑุญูู         โ
โ  POST /api/     โ
โ  invoices/post  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  is_posted=1    โ  โโโ ุชุฃุซูุฑ ุนูู ุงูุญุณุงุจุงุช
โ  posted_at=now  โ
โ  posted_by=user โ
โโโโโโโโโโโโโโโโโโโ
```

### ุญุงูุงุช ุงููุงุชูุฑุฉ/ุงูููุฏ

| ุงูุญุงูุฉ | `is_posted` | ุงููุตู | ูููู ุงูุชุนุฏููุ |
|--------|-------------|-------|---------------|
| **ุบูุฑ ูุฑุญูู** | `0` / `False` | ุชู ุงูุฅูุดุงุก ููู ูุชู ุงูุชุฑุญูู | โ ูุนู |
| **ูุฑุญูู** | `1` / `True` | ุชู ุงูุชุฑุญูู ูุงูุชุฃุซูุฑ ุนูู ุงูุญุณุงุจุงุช | โ๏ธ ุจุญุฐุฑ |

---

## ๐ API Endpoints

### ๐ ุนุฑุถ ุงูููุงุชูุฑ/ุงููููุฏ

#### 1. ุงูููุงุชูุฑ ุบูุฑ ุงููุฑุญูุฉ
```http
GET /api/invoices/unposted
```

**Response:**
```json
{
  "success": true,
  "count": 5,
  "invoices": [
    {
      "id": 123,
      "invoice_type": "ุจูุน",
      "total": 5000,
      "is_posted": false,
      "posted_at": null,
      "posted_by": null
    }
  ]
}
```

#### 2. ุงูููุงุชูุฑ ุงููุฑุญูุฉ
```http
GET /api/invoices/posted
```

#### 3. ุงููููุฏ ุบูุฑ ุงููุฑุญูุฉ
```http
GET /api/journal-entries/unposted
```

#### 4. ุงููููุฏ ุงููุฑุญูุฉ
```http
GET /api/journal-entries/posted
```

---

### โ ุชุฑุญูู ุงููุนุงููุงุช

#### 1. ุชุฑุญูู ูุงุชูุฑุฉ ูุงุญุฏุฉ
```http
POST /api/invoices/post/123
Content-Type: application/json

{
  "posted_by": "ุฃุญูุฏ ูุญูุฏ"
}
```

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุชุฑุญูู ุงููุงุชูุฑุฉ ุจูุฌุงุญ",
  "invoice": {
    "id": 123,
    "is_posted": true,
    "posted_at": "2024-01-15T10:30:00",
    "posted_by": "ุฃุญูุฏ ูุญูุฏ"
  }
}
```

#### 2. ุชุฑุญูู ูุฌููุนุฉ ููุงุชูุฑ
```http
POST /api/invoices/post-batch
Content-Type: application/json

{
  "invoice_ids": [123, 124, 125],
  "posted_by": "ุฃุญูุฏ ูุญูุฏ"
}
```

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุชุฑุญูู 3 ูุงุชูุฑุฉุ ุชู ุชุฎุทู 0",
  "posted_count": 3,
  "skipped_count": 0
}
```

#### 3. ุฅูุบุงุก ุชุฑุญูู ูุงุชูุฑุฉ
```http
POST /api/invoices/unpost/123
```

โ๏ธ **ุชุญุฐูุฑ:** ูุฐุง ุงูุฅุฌุฑุงุก ุญุณุงุณ ููุฌุจ ุงุณุชุฎุฏุงูู ุจุญุฐุฑ!

#### 4. ุชุฑุญูู ููุฏ ููููุฉ
```http
POST /api/journal-entries/post/456
Content-Type: application/json

{
  "posted_by": "ุฃุญูุฏ ูุญูุฏ"
}
```

**ููุงุญุธุฉ:** ุงููุธุงู ูุชุญูู ูู ุชูุงุฒู ุงูููุฏ ูุจู ุงูุชุฑุญูู:
```
ุฅุฌูุงูู ุงููุฏูู = ุฅุฌูุงูู ุงูุฏุงุฆู ยฑ 0.01
```

#### 5. ุชุฑุญูู ูุฌููุนุฉ ูููุฏ
```http
POST /api/journal-entries/post-batch
Content-Type: application/json

{
  "entry_ids": [456, 457, 458],
  "posted_by": "ุฃุญูุฏ ูุญูุฏ"
}
```

#### 6. ุฅูุบุงุก ุชุฑุญูู ููุฏ
```http
POST /api/journal-entries/unpost/456
```

---

### ๐ ุฅุญุตุงุฆูุงุช

```http
GET /api/posting/stats
```

**Response:**
```json
{
  "success": true,
  "stats": {
    "invoices": {
      "total": 150,
      "posted": 120,
      "unposted": 30
    },
    "journal_entries": {
      "total": 200,
      "posted": 180,
      "unposted": 20
    }
  }
}
```

---

## ๐ก ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุฑุญูู ููุงุชูุฑ ููู ูุงูู

```bash
# 1. ุงุญุตู ุนูู ุฌููุน ููุงุชูุฑ ุงูููู ุบูุฑ ุงููุฑุญูุฉ
curl http://localhost:8001/api/invoices/unposted

# 2. ุฑุญูู ุงูููุงุชูุฑ ุงููุฎุชุงุฑุฉ
curl -X POST http://localhost:8001/api/invoices/post-batch \
  -H "Content-Type: application/json" \
  -d '{
    "invoice_ids": [101, 102, 103],
    "posted_by": "ุฃุญูุฏ ูุญูุฏ"
  }'
```

### ูุซุงู 2: ูุฑุงุฌุนุฉ ููุฏ ูุจู ุงูุชุฑุญูู

```bash
# 1. ุงุญุตู ุนูู ุชูุงุตูู ุงูููุฏ
curl http://localhost:8001/api/journal-entries/456

# 2. ุชุญูู ูู ุงูุชูุงุฒู
# ุงููุฏูู = ุงูุฏุงุฆูุ

# 3. ุฑุญูู ุงูููุฏ
curl -X POST http://localhost:8001/api/journal-entries/post/456 \
  -H "Content-Type: application/json" \
  -d '{"posted_by": "ุฃุญูุฏ ูุญูุฏ"}'
```

### ูุซุงู 3: ุฅูุบุงุก ุชุฑุญูู ุฎุงุทุฆ

```bash
# 1. ุฃูุบู ุงูุชุฑุญูู
curl -X POST http://localhost:8001/api/invoices/unpost/123

# 2. ุนุฏูู ุงููุงุชูุฑุฉ
curl -X PUT http://localhost:8001/api/invoices/123 \
  -H "Content-Type: application/json" \
  -d '{"total": 6000}'

# 3. ุฑุญูู ูุฑุฉ ุฃุฎุฑู
curl -X POST http://localhost:8001/api/invoices/post/123 \
  -H "Content-Type: application/json" \
  -d '{"posted_by": "ุฃุญูุฏ ูุญูุฏ"}'
```

---

## ๐ก๏ธ ุฃูุถู ุงูููุงุฑุณุงุช

### 1. ุงูุชุฑุญูู ุงููููู

โ **ุงูุนู:**
```
ููุงูุฉ ูู ููู ุนูู โ ุฑุงุฌุน ุงูููุงุชูุฑ โ ุฑุญูู ุงูุตุญูุญ ูููุง
```

โ **ูุง ุชูุนู:**
```
ุงูุชุธุฑ ุฃุณุจูุน โ ุฑุญูู ูู ุดูุก ูุฑุฉ ูุงุญุฏุฉ
```

### 2. ุงูุชูุซูู

โ **ุงูุนู:**
```python
posted_by = "ุฃุญูุฏ ูุญูุฏ - ูุญุงุณุจ"  # ุงุณู ูุงุถุญ
```

โ **ูุง ุชูุนู:**
```python
posted_by = "user123"  # ุบูุฑ ูุงุถุญ
```

### 3. ุงููุฑุงุฌุนุฉ ูุจู ุงูุชุฑุญูู

โ **ุงูุนู:**
```
1. ุฑุงุฌุน ุงูุจูุงูุงุช
2. ุชุญูู ูู ุงูุญุณุงุจุงุช
3. ุชุฃูุฏ ูู ุงูุชูุงุฒู
4. ุฑุญูู
```

โ **ูุง ุชูุนู:**
```
ุฑุญูู ูุจุงุดุฑุฉ ุจุฏูู ูุฑุงุฌุนุฉ
```

### 4. ุฅูุบุงุก ุงูุชุฑุญูู

โ **ุงูุนู:**
```
ุงุณุชุฎุฏู ุฅูุบุงุก ุงูุชุฑุญูู ููุฃุฎุทุงุก ุงูุญููููุฉ ููุท
ุณุฌูู ุณุจุจ ุงูุฅูุบุงุก
```

โ **ูุง ุชูุนู:**
```
ุชูุบู ุงูุชุฑุญูู ุจุดูู ุนุดูุงุฆู
```

### 5. ุงูุชูุงุฑูุฑ

โ **ุงูุนู:**
```
ุงุณุชุฎุฏู ููุท ุงููุนุงููุงุช ุงููุฑุญูุฉ (is_posted=1) ูู ุงูุชูุงุฑูุฑ ุงููุงููุฉ
```

โ **ูุง ุชูุนู:**
```
ุงุฎูุท ุงููุฑุญูู ูุบูุฑ ุงููุฑุญูู ูู ููุณ ุงูุชูุฑูุฑ
```

---

## ๐ ุงุณุชุนูุงูุงุช ูููุฏุฉ

### ููุงุชูุฑ ุงูููู ุบูุฑ ุงููุฑุญูุฉ

```sql
SELECT * FROM invoice 
WHERE is_posted = 0 
  AND date(date) = date('now')
ORDER BY date DESC;
```

### ุขุฎุฑ 10 ุนูููุงุช ุชุฑุญูู

```sql
SELECT 
  'invoice' as type,
  id, 
  posted_at, 
  posted_by 
FROM invoice 
WHERE is_posted = 1

UNION ALL

SELECT 
  'journal_entry' as type,
  id, 
  posted_at, 
  posted_by 
FROM journal_entry 
WHERE is_posted = 1

ORDER BY posted_at DESC 
LIMIT 10;
```

### ุฅุญุตุงุฆูุงุช ุญุณุจ ุงููุณุชุฎุฏู

```sql
-- ุฅุญุตุงุฆูุงุช ุชุฑุญูู ุงูููุงุชูุฑ
SELECT 
  posted_by, 
  COUNT(*) as count,
  SUM(total) as total_amount
FROM invoice 
WHERE is_posted = 1
GROUP BY posted_by;

-- ุฅุญุตุงุฆูุงุช ุชุฑุญูู ุงููููุฏ
SELECT 
  posted_by, 
  COUNT(*) as count
FROM journal_entry 
WHERE is_posted = 1
GROUP BY posted_by;
```

---

## ๐จ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### ุฎุทุฃ 1: "ุงููุงุชูุฑุฉ ูุฑุญูุฉ ุจุงููุนู"

```json
{
  "success": false,
  "message": "ุงููุงุชูุฑุฉ ูุฑุญูุฉ ุจุงููุนู"
}
```

**ุงูุญู:** ุชุญูู ูู ุญุงูุฉ `is_posted` ูุจู ูุญุงููุฉ ุงูุชุฑุญูู.

### ุฎุทุฃ 2: "ุงูููุฏ ุบูุฑ ูุชูุงุฒู"

```json
{
  "success": false,
  "message": "ุงูููุฏ ุบูุฑ ูุชูุงุฒู. ูุฏูู: 1000, ุฏุงุฆู: 900"
}
```

**ุงูุญู:** ุฑุงุฌุน ุณุทูุฑ ุงูููุฏ ูุตุญูุญ ุงููุจุงูุบ.

### ุฎุทุฃ 3: "ุงูููุฏ ูุญุฐูู"

```json
{
  "success": false,
  "message": "ุงูููุฏ ูุญุฐูู"
}
```

**ุงูุญู:** ุงุณุชุฑุฌุน ุงูููุฏ ุฃููุงู ูุจู ุงูุชุฑุญูู.

---

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุชุ ุฑุงุฌุน:
- `backend/models.py` - ููุงุฐุฌ ุงูุจูุงูุงุช
- `backend/posting_routes.py` - ููุทู API
- `backend/add_posting_fields.py` - ุณูุฑูุจุช ุงูุชุฑุญูู

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

- [ ] ุฅุถุงูุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู (ูู ูุณุชุทูุน ุงูุชุฑุญููุ)
- [ ] ุชูุงุฑูุฑ ุงูุชุฑุญูู ุงููุชูุฏูุฉ
- [ ] ุฅุดุนุงุฑุงุช ุนูุฏ ุงูุชุฑุญูู
- [ ] ุณุฌู ุชุฏููู ูุงูู (Audit Trail)
- [ ] ุชุฑุญูู ุชููุงุฆู ูุฌุฏูู

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2024-01-15  
**ุงูุฅุตุฏุงุฑ:** 1.0
