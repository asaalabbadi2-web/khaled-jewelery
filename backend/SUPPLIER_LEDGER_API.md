# ๐ Supplier Ledger API - ุฏููู ูุดู ุญุณุงุจ ุงูููุฑุฏูู

## โ ุงูุชุญุฏูุซุงุช ุงููููุฐุฉ

### 1๏ธโฃ ุชูุนูู ุชุชุจุน ุงููุฒู ูุญุณุงุจ ุงูููุฑุฏูู

ุชู ุชูุนูู `tracks_weight = TRUE` ููุญุณุงุจ ุงูุชุฌููุนู "ุงูููุฑุฏูู" (211) ูู ุดุฌุฑุฉ ุงูุญุณุงุจุงุช.

**ููู ุงูุชูููุฐ:** `enable_supplier_weight_tracking.py`

```bash
cd backend
./venv/bin/python enable_supplier_weight_tracking.py
```

**ุงููุชูุฌุฉ:**
- โ ุญุณุงุจ ุงูููุฑุฏูู (211) ุงูุขู ูุชุชุจุน ุงูุฃูุฒุงู
- โ ููุงุชูุฑ ุดุฑุงุก ุงูููุฑุฏูู ุณุชูุณุฌูู ุงูุฐูุจ ุจุดูู ุตุญูุญ
- โ ุงูุฃุฑุตุฏุฉ ุณุชุธูุฑ ูู ุงูุชูุงุฑูุฑ

---

## 2๏ธโฃ API Endpoints ุงูุฌุฏูุฏุฉ

### ๐ ุงูุญุตูู ุนูู ุฑุตูุฏ ููุฑุฏ ูุญุฏุฏ

**Endpoint:** `GET /api/suppliers/{supplier_id}/balance`

**ุงููุตู:** ุฌูุจ ุฑุตูุฏ ุงูููุฑุฏ ุงูุญุงูู ุจุณุฑุนุฉ (ููุฏู + ุฃูุฒุงู ุงูุฐูุจ)

**ูุซุงู:**
```bash
curl http://localhost:8001/api/suppliers/1/balance
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "supplier_id": 1,
    "supplier_name": "ูุตุงุบ",
    "supplier_code": "S-000001",
    "balance": {
        "cash": 5089.99,
        "gold_18k": 0.0,
        "gold_21k": 201.24,
        "gold_22k": 0.0,
        "gold_24k": 0.0,
        "total_gold_21k_equivalent": 201.24
    }
}
```

**ุงูุญููู:**
- `cash`: ุงูุฑุตูุฏ ุงูููุฏู ุจุงูุฑูุงู
- `gold_18k`, `gold_21k`, `gold_22k`, `gold_24k`: ุงูุฃูุฒุงู ุจุงูุฌุฑุงู ุญุณุจ ุงูุนูุงุฑ
- `total_gold_21k_equivalent`: ุฅุฌูุงูู ุงูุฐูุจ ูุญุณูุจุงู ุจุงูุนูุงุฑ ุงูุฑุฆูุณู (21)

---

### ๐ ูุดู ุญุณุงุจ ููุฑุฏ ุชูุตููู

**Endpoint:** `GET /api/suppliers/{supplier_id}/ledger`

**ุงููุตู:** ุฌูุจ ุฌููุน ุญุฑูุงุช ุงูููุฑุฏ ุงูุชูุตูููุฉ ูุน ุงูุฅุฌูุงููุงุช ูุงูุฃุฑุตุฏุฉ

**Parameters:**
- `date_from` (optional): ุชุงุฑูุฎ ุงูุจุฏุงูุฉ (ISO format: `2025-01-01`)
- `date_to` (optional): ุชุงุฑูุฎ ุงูููุงูุฉ
- `page` (optional): ุฑูู ุงูุตูุญุฉ (default: 1)
- `per_page` (optional): ุนุฏุฏ ุงูุณุฌูุงุช (default: 50)

**ูุซุงู:**
```bash
# ูู ุงูุญุฑูุงุช
curl http://localhost:8001/api/suppliers/1/ledger

# ุญุฑูุงุช ูุญุฏุฏุฉ ุจุงูุชุงุฑูุฎ
curl "http://localhost:8001/api/suppliers/1/ledger?date_from=2025-11-01&date_to=2025-11-30"

# ูุน ุชุฑููู ุงูุตูุญุงุช
curl "http://localhost:8001/api/suppliers/1/ledger?page=1&per_page=20"
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "supplier": {
        "id": 1,
        "supplier_code": "S-000001",
        "name": "ูุตุงุบ",
        "balance_cash": 5089.99,
        "balance_gold_21k": 201.24,
        "..."
    },
    "movements": [
        {
            "date": "2025-11-03T10:30:00",
            "entry_number": "JE-000123",
            "description": "ุดุฑุงุก ูู ููุฑุฏ - ูุงุชูุฑุฉ 456",
            "reference_type": "invoice",
            "reference_id": 456,
            "account_name": "ุงูููุฑุฏูู",
            "cash_debit": 0.0,
            "cash_credit": 0.0,
            "gold_21k_debit": 0.0,
            "gold_21k_credit": 201.24,
            "..."
        }
    ],
    "summary": {
        "total_debits": {
            "cash": 0.0,
            "gold_21k": 0.0,
            "..."
        },
        "total_credits": {
            "cash": 0.0,
            "gold_21k": 201.24,
            "..."
        },
        "closing_balance": {
            "cash": 5089.99,
            "gold_21k": 201.24,
            "..."
        }
    },
    "pagination": {
        "page": 1,
        "per_page": 50,
        "total_pages": 1,
        "total_items": 1
    }
}
```

---

## ๐ ููู ูุนูู ุงููุธุงูุ

### ุงูุจููุฉ ุงููุญุงุณุจูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Supplier (ุฌุฏูู ุงูููุฑุฏูู)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  - supplier_code: S-000001              โ
โ  - name: ูุตุงุบ                          โ
โ  - account_category_id โ 38 (ุญุณุงุจ 211) โ
โ  - balance_cash: 5089.99 (ููุณุฑุนุฉ)      โ
โ  - balance_gold_21k: 201.24             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโโโโโโโโโโโโ
              โ                     โ
โโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Account (211)     โ   โ  JournalEntryLine        โ
โโโโโโโโโโโโโโโโโโโโโโค   โโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงูููุฑุฏูู         โ   โ  - supplier_id: 1        โ
โ  tracks_weight: โ โ   โ  - account_id: 38 (211)  โ
โ  balance_21k: XXX  โ   โ  - credit_21k: 201.24    โ
โโโโโโโโโโโโโโโโโโโโโโ   โ  - entry_id โ JE-000123  โ
                         โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุชุฏูู ุงูุจูุงูุงุช

1. **ุฅูุดุงุก ูุงุชูุฑุฉ ุดุฑุงุก ูู ููุฑุฏ:**
   - ูููุดุฃ ุณุทุฑ ูู `journal_entry_lines` ูุน `supplier_id`
   - ููุณุฌูู ุงููุฒู ูู `credit_21k` (ุฃู ุงูุนูุงุฑ ุงูููุงุณุจ)
   - ููุญุฏูุซ ุฑุตูุฏ `supplier.balance_gold_21k`
   - ููุญุฏูุซ ุฑุตูุฏ `account.balance_21k` (ุญุณุงุจ 211)

2. **ุงุณุชุนูุงู ูุดู ุงูุญุณุงุจ:**
   - ุฌูุจ ูู `journal_entry_lines` ุญูุซ `supplier_id = X`
   - ุงูุฑุจุท ูุน `journal_entries` ููุญุตูู ุนูู ุงูุชุงุฑูุฎ ูุงููุตู
   - ุญุณุงุจ ุงูุฅุฌูุงููุงุช
   - ุนุฑุถ ุงูุฑุตูุฏ ุงูุฎุชุงูู ูู `suppliers.balance_*`

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงุฆู

### 1. ุฅูุดุงุก ูุงุชูุฑุฉ ุดุฑุงุก ุงุฎุชุจุงุฑูุฉ

```bash
curl -X POST http://localhost:8001/api/invoices \
  -H "Content-Type: application/json" \
  -d '{
    "invoice_type": "ุดุฑุงุก ูู ููุฑุฏ",
    "supplier_id": 1,
    "date": "2025-11-04T10:00:00",
    "karat_lines": [
      {
        "karat": 21,
        "weight_grams": 100,
        "gold_value_cash": 25000,
        "manufacturing_wage_cash": 500
      }
    ],
    "apply_gold_tax": true
  }'
```

### 2. ุงูุชุญูู ูู ุงูุฑุตูุฏ

```bash
curl http://localhost:8001/api/suppliers/1/balance | jq
```

**ุงููุชููุน:**
- `balance_gold_21k` ูุฌุจ ุฃู ูุฒูุฏ ุจููุฏุงุฑ ุงููุฒู ุงูููุดุชุฑู
- `balance_cash` ูุฏ ูุชุฃุซุฑ ุญุณุจ ุทุฑููุฉ ุงูุฏูุน

### 3. ูุฑุงุฌุนุฉ ูุดู ุงูุญุณุงุจ

```bash
curl http://localhost:8001/api/suppliers/1/ledger | jq '.movements'
```

**ุงููุชููุน:**
- ุธููุฑ ุญุฑูุฉ ุฌุฏูุฏุฉ ุจุชุงุฑูุฎ ุงูููู
- `gold_21k_credit` = 100 ุฌุฑุงู
- `description` ูุดูุฑ ูููุงุชูุฑุฉ

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุฑุตูุฏ ุงูููุฑุฏ ูุง ูุธูุฑ

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชูุนูู `tracks_weight` ููุญุณุงุจ:
   ```bash
   ./venv/bin/python enable_supplier_weight_tracking.py
   ```

2. ุชุญูู ูู `accounting_mappings`:
   ```sql
   SELECT * FROM accounting_mapping 
   WHERE operation_type LIKE '%ููุฑุฏ%';
   ```

3. ุชุฃูุฏ ูู ุฃู `supplier_id` ููุฌูุฏ ูู `journal_entry_lines`

### ุงููุดููุฉ: Endpoint ูุฑุฌุน 404

**ุงูุญู:**
- ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุฑ ุจุนุฏ ุงูุชุนุฏููุงุช:
  ```bash
  cd backend
  lsof -ti:8001 | xargs kill -9 2>/dev/null; true
  ./venv/bin/python app.py
  ```

### ุงููุดููุฉ: ุงูุญุฑูุงุช ูุงุฑุบุฉ ุฑุบู ูุฌูุฏ ููุงุชูุฑ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุงูููุงุชูุฑ ุงููุฏููุฉ ุชู ุชุณุฌูููุง ุจู `supplier_id` ูู ุงููููุฏ
- ุฑุงุฌุน `journal_entry_lines` ูุจุงุดุฑุฉ:
  ```sql
  SELECT * FROM journal_entry_line 
  WHERE supplier_id IS NOT NULL;
  ```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุญุณุงุจ ุงูุชุฌููุนู ููุงุจู ุงูุชูุตููู:**
   - ุงููุธุงู ุงูุญุงูู ูุณุชุฎุฏู ุญุณุงุจ ุชุฌููุนู ูุงุญุฏ (211)
   - ูู ููุฑุฏ ููุนุฑูู ุจู `supplier_id` ูู ุงููููุฏ
   - ุงูุฑุตูุฏ ุงูุชูุตููู ูุญููุธ ูู ุฌุฏูู `suppliers`
   - ูุฐุง ุฃุจุณุท ูุฃุณุฑุน ูู ุฅูุดุงุก ุญุณุงุจุงุช ูุฑุนูุฉ ููู ููุฑุฏ

2. **ุงูุฃุฏุงุก:**
   - ุงุณุชุนูุงู ุงูุฑุตูุฏ (`/balance`) ุณุฑูุน ุฌุฏุงู (ูุฑุงุกุฉ ูุจุงุดุฑุฉ)
   - ูุดู ุงูุญุณุงุจ (`/ledger`) ูุฏ ูุจุทุฆ ูุน ุขูุงู ุงูุญุฑูุงุช (ุงุณุชุฎุฏู ุงูุชุฑููู)

3. **ุงูุชูุงูู ูุน ุงููุฑููุช-ุฅูุฏ:**
   - ูููู ุนุฑุถ ูุดู ุญุณุงุจ ููู ููุฑุฏ ูู ุตูุญุฉ ูููุตูุฉ
   - ุฅุถุงูุฉ ููุงุชุฑ ุจุงูุชุงุฑูุฎ ูุงูุชุฑููู
   - ุชุตุฏูุฑ ุฅูู PDF ุฃู Excel

---

## ๐ ุฎุทูุงุช ูุณุชูุจููุฉ

- [ ] ุฅุถุงูุฉ endpoint ููุดู ุญุณุงุจ ุงูุนููู (ููุงุซู)
- [ ] ุชูุฑูุฑ ููุงุฑู ุจูู ุงูููุฑุฏูู
- [ ] ุชูุจููุงุช ุนูุฏ ุชุฌุงูุฒ ุญุฏ ูุนูู ูู ุงูุฑุตูุฏ
- [ ] ุชุตุฏูุฑ ูุดู ุงูุญุณุงุจ PDF
- [ ] ุฑุณูู ุจูุงููุฉ ูุญุฑูุงุช ุงูููุฑุฏ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 4 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
