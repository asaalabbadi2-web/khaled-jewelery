# ๐ข ูุธุงู ุงูุชุฑููู ุงูุชููุงุฆู ูู ูุธุงู ูุงุณุฑ ููุฐูุจ

## ๐ ุฌุฏูู ุงููุญุชููุงุช
1. [ุงููููุฏ ุงูููููุฉ (Journal Entries)](#ุงููููุฏ-ุงูููููุฉ)
2. [ุงูููุงุชูุฑ (Invoices)](#ุงูููุงุชูุฑ)
3. [ุงูุญุณุงุจุงุช (Accounts)](#ุงูุญุณุงุจุงุช)
4. [ููุฎุต ุงูุฃูุธูุฉ](#ููุฎุต-ุงูุฃูุธูุฉ)

---

## ๐งพ ุงููููุฏ ุงูููููุฉ (Journal Entries)

### ุงููุธุงู ุงููุทุจู
ูุชู ุชูููุฏ ุฑูู ููุฏ ููููุฉ **ุชููุงุฆูุงู** ููู ููุฏ ุจุงูุดูู ุงูุชุงูู:

```
JE-YYYY-XXXXX
```

ุญูุซ:
- **JE**: ุงุฎุชุตุงุฑ Journal Entry
- **YYYY**: ุงูุณูุฉ ุงููููุงุฏูุฉ (4 ุฃุฑูุงู)
- **XXXXX**: ุฑูู ุชุณูุณูู (5 ุฃุฑูุงูุ ูุจุฏุฃ ูู 00001)

### ุฃูุซูุฉ:
```
JE-2025-00001  โ ุฃูู ููุฏ ูู ุณูุฉ 2025
JE-2025-00002  โ ุซุงูู ููุฏ ูู ุณูุฉ 2025
JE-2025-00150  โ ุงูููุฏ ุฑูู 150 ูู ุณูุฉ 2025
JE-2026-00001  โ ุฃูู ููุฏ ูู ุณูุฉ 2026 (ูุนุงุฏ ุงูุชุณูุณู)
```

### ุงูููุฏ ุงููุณุคูู
**File:** `backend/routes.py` - ุงูุณุทุฑ 86

```python
def _generate_journal_entry_number(entry_date: datetime) -> str:
    """ุชูููุฏ ุฑูู ููุฏ ููููุฉ ุจุงูุดูู JE-YYYY-00001"""
    year = entry_date.year
    prefix = f'JE-{year}-'

    last_entry = (
        JournalEntry.query
        .filter(JournalEntry.entry_number.like(f"{prefix}%"))
        .order_by(JournalEntry.entry_number.desc())
        .first()
    )

    if last_entry:
        try:
            last_sequence = int(str(last_entry.entry_number).split('-')[-1])
        except (ValueError, AttributeError):
            start_of_year = datetime(year, 1, 1)
            end_of_year = datetime(year + 1, 1, 1)
            last_sequence = (
                JournalEntry.query
                .filter(JournalEntry.date >= start_of_year, JournalEntry.date < end_of_year)
                .count()
            )
    else:
        last_sequence = 0
    
    next_sequence = last_sequence + 1
    return f'{prefix}{next_sequence:05d}'
```

### ุฎุตุงุฆุต ุงููุธุงู
- โ **ุชููุงุฆู ุจุงููุงูู**: ูุง ูุญุชุงุฌ ุงููุณุชุฎุฏู ูุฅุฏุฎุงู ุฑูู
- โ **ูุฑูุฏ (Unique)**: ูู ููุฏ ูู ุฑูู ูุฎุชูู
- โ **ูุนุงุฏ ุณูููุงู**: ุงูุชุณูุณู ูุจุฏุฃ ูู 1 ูู ูู ุณูุฉ ุฌุฏูุฏุฉ
- โ **ููุธู**: ุณูู ุงูุจุญุซ ูุงูุชุฑุชูุจ
- โ **ุขูู**: ูุชุนุงูู ูุน ุงูุฃุฎุทุงุก ูุงูุชุฏุงุฎู

### ุงูุงุณุชุฎุฏุงู ูู API
ุนูุฏ ุฅูุดุงุก ููุฏ ููููุฉ ุฌุฏูุฏ:

```python
# ูุชู ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุชููุงุฆูุงู
entry_number = _generate_journal_entry_number(entry_date)

new_entry = JournalEntry(
    entry_number=entry_number,  # JE-2025-00001
    date=entry_date,
    description=description,
    # ...
)
```

---

## ๐ ุงูููุงุชูุฑ (Invoices)

### ุงููุธุงู ุงููุทุจู
ูู **ููุน ูุงุชูุฑุฉ** ูู ุชุณูุณู ุฎุงุต ููุณุชูู!

#### ุฃููุงุน ุงูููุงุชูุฑ ุงูุณุชุฉ:
1. **ุจูุน** - ููุงุชูุฑ ุจูุน ููุนููุงุก
2. **ุดุฑุงุก ูู ุนููู** - ุดุฑุงุก ุฐูุจ ูุณุชุนูู ูู ุงูุนููุงุก
3. **ูุฑุชุฌุน ุจูุน** - ุฅุฑุฌุงุน ุจุถุงุนุฉ ูุจุงุนุฉ
4. **ูุฑุชุฌุน ุดุฑุงุก** - ุฅุฑุฌุงุน ุจุถุงุนุฉ ูุดุชุฑุงุฉ ูู ุนููู
5. **ุดุฑุงุก** - ุดุฑุงุก ุจุถุงุนุฉ ุฌุฏูุฏุฉ ูู ุงูููุฑุฏูู
6. **ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ)** - ุฅุฑุฌุงุน ุจุถุงุนุฉ ููููุฑุฏูู

### ุงูุชุฑููู
ูู ููุน ูุงุชูุฑุฉ ูู **ุญูู `invoice_type_id`** ูุจุฏุฃ ูู 1:

```
ููุน ุงููุงุชูุฑุฉ: ุจูุน
- ุงููุงุชูุฑุฉ ุงูุฃููู: invoice_type_id = 1
- ุงููุงุชูุฑุฉ ุงูุซุงููุฉ: invoice_type_id = 2
- ุงููุงุชูุฑุฉ ุงูุซุงูุซุฉ: invoice_type_id = 3

ููุน ุงููุงุชูุฑุฉ: ุดุฑุงุก ูู ุนููู
- ุงููุงุชูุฑุฉ ุงูุฃููู: invoice_type_id = 1
- ุงููุงุชูุฑุฉ ุงูุซุงููุฉ: invoice_type_id = 2
```

### ุงูููุฏ ุงููุณุคูู
**File:** `backend/routes.py` - ุงูุณุทุฑ 1700

```python
# ุงูุจุญุซ ุนู ุขุฎุฑ ูุงุชูุฑุฉ ูู ููุณ ุงูููุน
last_invoice = Invoice.query.filter_by(
    invoice_type=invoice_type
).order_by(Invoice.invoice_type_id.desc()).first()

# ุชูููุฏ ุงูุฑูู ุงูุชุงูู
next_invoice_type_id = (last_invoice.invoice_type_id + 1) if last_invoice else 1

new_invoice = Invoice(
    invoice_type_id=next_invoice_type_id,
    invoice_type=invoice_type,
    # ...
)
```

### ุฎุตุงุฆุต ุงููุธุงู
- โ **ุชููุงุฆู**: ูุง ูุญุชุงุฌ ุงููุณุชุฎุฏู ูุฅุฏุฎุงู ุฑูู
- โ **ูุณุชูู ููู ููุน**: ูู ููุน ูุงุชูุฑุฉ ูู ุชุณูุณู ุฎุงุต
- โ **ุจุณูุท**: ุฃุฑูุงู ูุชุณูุณูุฉ ูู 1, 2, 3, ...
- โ๏ธ **ูุง ูุนุงุฏ ุณูููุงู**: ุงูุชุณูุณู ูุณุชูุฑ ุนุจุฑ ุงูุณููุงุช

### ูุซุงู ุนููู:

```
ููุงุชูุฑ ุงูุจูุน:
  INV-SELL-1  (invoice_type_id=1, invoice_type='ุจูุน')
  INV-SELL-2  (invoice_type_id=2, invoice_type='ุจูุน')
  INV-SELL-3  (invoice_type_id=3, invoice_type='ุจูุน')

ููุงุชูุฑ ุงูุดุฑุงุก ูู ุนููู:
  INV-BUY-1   (invoice_type_id=1, invoice_type='ุดุฑุงุก ูู ุนููู')
  INV-BUY-2   (invoice_type_id=2, invoice_type='ุดุฑุงุก ูู ุนููู')

ูุฑุชุฌุนุงุช ุงูุจูุน:
  INV-RETSELL-1 (invoice_type_id=1, invoice_type='ูุฑุชุฌุน ุจูุน')
```

### ุญููู ุงููุงุชูุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```python
class Invoice(db.Model):
    id = db.Column(db.Integer, primary_key=True)           # ุงููุนุฑู ุงููุฑูุฏ ุงูุนุงู
    invoice_type_id = db.Column(db.Integer, nullable=False) # ุงูุฑูู ุงูุชุณูุณูู ุญุณุจ ุงูููุน
    invoice_type = db.Column(db.String(50), nullable=False) # ููุน ุงููุงุชูุฑุฉ
    # ...
```

### ุนุฑุถ ุฑูู ุงููุงุชูุฑุฉ ูู ุงููุงุฌูุฉ:

ูููู ุนุฑุถ ุงููุงุชูุฑุฉ ุจุงูุดูู:
```
ูุงุชูุฑุฉ ุจูุน ุฑูู #150
ูุงุชูุฑุฉ ุดุฑุงุก ูู ุนููู ุฑูู #75
ูุงุชูุฑุฉ ูุฑุชุฌุน ุจูุน ุฑูู #12
```

---

## ๐ฅ ุงูุญุณุงุจุงุช (Accounts)

### ุงููุธุงู ุงููุทุจู
ูุณุชุฎุฏู ูุธุงู **ุชุฑููู ูุฑูู** ุจุณุนุงุช ูุญุฏุฏุฉ ููู ูุฆุฉ.

### ุงูุนููุงุก (Customers)

#### 1. ุนููุงุก ุจูุน ุฐูุจ (Account 1100)
- **ุงููุทุงู:** 110000 - 119999
- **ุงูุณุนุฉ:** 10,000 ุนููู
- **ุงูุชุฑููู:** ูุชุตู ุจุฏูู ูุฑุงุบุงุช

```
110000 โ ุงูุนููู ุงูุฃูู
110001 โ ุงูุนููู ุงูุซุงูู
110002 โ ุงูุนููู ุงูุซุงูุซ
...
119999 โ ุงูุนููู 10,000
```

#### 2. ุนููุงุก ุตูุงุบุฉ (Account 1110)
- **ุงููุทุงู:** 111000 - 111999
- **ุงูุณุนุฉ:** 1,000 ุนููู

#### 3. ุนููุงุก ูุฌููุฑุงุช ุฌุงูุฒุฉ (Account 1120)
- **ุงููุทุงู:** 112000 - 112999
- **ุงูุณุนุฉ:** 1,000 ุนููู

### ุงูููุฑุฏูู (Suppliers)

#### ุญุณุงุจ ุงูููุฑุฏูู (Account 211)
- **ุงููุทุงู:** 21100 - 21999
- **ุงูุณุนุฉ:** 900 ููุฑุฏ

```
21100 โ ุงูููุฑุฏ ุงูุฃูู
21101 โ ุงูููุฑุฏ ุงูุซุงูู
...
21999 โ ุงูููุฑุฏ 900
```

### ุงูููุฏ ุงููุณุคูู
**File:** `backend/account_number_generator.py`

```python
def get_next_account_number(parent_number: str, use_spacing: bool = False) -> str:
    """
    ุชูููุฏ ุฑูู ุงูุญุณุงุจ ุงูุชุงูู ุจูุงุกู ุนูู ุงูุญุณุงุจ ุงูุฃุจ
    
    Args:
        parent_number: ุฑูู ุงูุญุณุงุจ ุงูุฃุจ (ูุซุงู: '1100' ููุนููุงุก)
        use_spacing: ูู ูุณุชุฎุฏู ูุฑุงุบุงุช (False = ูุชุตู)
    
    Returns:
        ุฑูู ุงูุญุณุงุจ ุงูุฌุฏูุฏ
    """
    # ุงูุจุญุซ ุนู ุขุฎุฑ ุญุณุงุจ ูุฑุนู
    last_account = (
        Account.query
        .filter(Account.account_number.like(f"{parent_number}%"))
        .order_by(Account.account_number.desc())
        .first()
    )
    
    if not last_account:
        # ุฃูู ุญุณุงุจ ูุฑุนู
        return f"{parent_number}00"
    
    # ุงุณุชุฎุฑุงุฌ ุงูุฑูู ุงูุชุณูุณูู
    last_number = last_account.account_number
    base_length = len(parent_number)
    sequence = int(last_number[base_length:])
    
    # ุงูุฑูู ุงูุชุงูู
    next_sequence = sequence + 1
    return f"{parent_number}{next_sequence:02d}"
```

### API Endpoints

```bash
# ุงูุญุตูู ุนูู ุงูุฑูู ุงูุชุงูู
GET /api/accounts/next-number/1100

# ุงูุชุญูู ูู ุตุญุฉ ุฑูู
POST /api/accounts/validate-number
{
  "account_number": "110005",
  "parent_number": "1100"
}

# ูุนูููุงุช ุงูุณุนุฉ
GET /api/accounts/capacity/1100
```

### ุฎุตุงุฆุต ุงููุธุงู
- โ **ูุฑูู**: ุงูุญุณุงุจุงุช ููุธูุฉ ูู ุดุฌุฑุฉ
- โ **ุณุนุฉ ูุญุฏุฏุฉ**: ูู ูุฆุฉ ููุง ุญุฏ ุฃูุตู
- โ **ูุชุตู**: ูุง ูุฑุงุบุงุช ูู ุงูุชุฑููู
- โ **ูุงุจู ููุชูุณุน**: ูููู ุฅุถุงูุฉ ูุฆุงุช ุฌุฏูุฏุฉ

---

## ๐ ููุฎุต ุงูุฃูุธูุฉ

### ููุงุฑูุฉ ุณุฑูุนุฉ:

| ุงูููุน | ุงูุตูุบุฉ | ูุณุชููุ | ูุนุงุฏ ุณูููุงูุ | ูุซุงู |
|------|--------|--------|-------------|------|
| **ููุฏ ููููุฉ** | `JE-YYYY-XXXXX` | ูุนู | โ ูุนู | `JE-2025-00001` |
| **ูุงุชูุฑุฉ ุจูุน** | `#XXX` | ุญุณุจ ุงูููุน | โ ูุง | `ูุงุชูุฑุฉ ุจูุน #150` |
| **ูุงุชูุฑุฉ ุดุฑุงุก** | `#XXX` | ุญุณุจ ุงูููุน | โ ูุง | `ูุงุชูุฑุฉ ุดุฑุงุก #75` |
| **ุญุณุงุจ ุนููู** | `110XXX` | ุญุณุจ ุงููุฆุฉ | โ ูุง | `110005` |
| **ุญุณุงุจ ููุฑุฏ** | `211XX` | ุญุณุจ ุงููุฆุฉ | โ ูุง | `21150` |

### ุงูุญููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```python
# ุงููููุฏ ุงูููููุฉ
JournalEntry.entry_number        # "JE-2025-00001" (Unique, String)
JournalEntry.reference_number     # ุฑูู ูุฑุฌุนู ุงุฎุชูุงุฑู

# ุงูููุงุชูุฑ
Invoice.id                        # ุงููุนุฑู ุงููุฑูุฏ ุงูุนุงู
Invoice.invoice_type_id           # ุงูุฑูู ุงูุชุณูุณูู ุญุณุจ ุงูููุน
Invoice.invoice_type              # ููุน ุงููุงุชูุฑุฉ

# ุงูุญุณุงุจุงุช
Account.account_number            # ุฑูู ุงูุญุณุงุจ (Unique, String)
Account.parent_id                 # ูุนุฑู ุงูุญุณุงุจ ุงูุฃุจ
```

---

## ๐ฏ ุฃูุถู ุงูููุงุฑุณุงุช

### 1. ุงููููุฏ ุงูููููุฉ
- โ **ุฏุงุฆูุงู ุงุณุชุฎุฏู `_generate_journal_entry_number()`**
- โ ูุง ุชุนุฏู ุฑูู ุงูููุฏ ูุฏููุงู
- โ ุงุณุชุฎุฏู `reference_number` ููุฅุดุงุฑุฉ ูููุงุชูุฑุฉ ุงูุฃุตููุฉ

### 2. ุงูููุงุชูุฑ
- โ ุฏุน ุงููุธุงู ูููุฏ `invoice_type_id` ุชููุงุฆูุงู
- โ ุงุณุชุฎุฏู `invoice_type` ูุชุญุฏูุฏ ุงูููุน
- โ ุงุนุฑุถ ุงูุฑูู ูููุณุชุฎุฏู ุจุตูุบุฉ ูุงุถุญุฉ

### 3. ุงูุญุณุงุจุงุช
- โ ุงุณุชุฎุฏู `get_next_account_number()` ูุชูููุฏ ุฃุฑูุงู ุฌุฏูุฏุฉ
- โ ุชุญูู ูู ุงูุณุนุฉ ูุจู ุงูุฅุถุงูุฉ
- โ ูุง ุชุชุฑู ูุฑุงุบุงุช ูู ุงูุชุฑููู

---

## ๐ง ููููุฉ ุงูุชุทุจูู ูู ุนูููุงุช ุงูุชุฌุฏูุฏ ูุงูุชูุณูุฑ

### ุนูุฏ ุฅูุดุงุก ููุฏ ุชุฌุฏูุฏ/ุชูุณูุฑ:

```python
# 1. ุชูููุฏ ุฑูู ุงูููุฏ ุงูุชููุงุฆู
entry_number = _generate_journal_entry_number(datetime.now())

# 2. ุฅูุดุงุก ุงูููุฏ
new_entry = JournalEntry(
    entry_number=entry_number,           # JE-2025-00150
    date=datetime.now(),
    description="ุชุฌุฏูุฏ ุฐูุจ ูุณุชุนูู",
    reference_number=f"REN-{renewal_id}",  # ูุฑุฌุน ุงุฎุชูุงุฑู
    entry_type='renewal',                   # ููุน ูุฎุตุต
    # ...
)

# 3. ุฅุถุงูุฉ ุงูุฃุณุทุฑ
for line in lines:
    entry_line = JournalEntryLine(
        journal_entry_id=new_entry.id,
        account_id=line['account_id'],
        debit=line.get('debit', 0),
        credit=line.get('credit', 0),
        # ...
    )
    db.session.add(entry_line)

db.session.add(new_entry)
db.session.commit()
```

### ูู Flutter (Frontend):

```dart
// ูุง ุญุงุฌุฉ ูุฅุฑุณุงู entry_number - ุณูุชู ุชูููุฏู ุชููุงุฆูุงู
final payload = {
  'date': DateTime.now().toIso8601String(),
  'description': 'ุชุฌุฏูุฏ ุฐูุจ ูุณุชุนูู',
  'lines': [
    {
      'account_id': 113,  // ุฃุญุฌุงุฑ ููุตูุต ุงูุชุฌุฏูุฏ
      'credit': gemsWeight,
      'weight': gemsWeight,
      'karat': karat,
    },
    // ...
  ],
};

// Backend ุณูููุฏ entry_number ุชููุงุฆูุงู
await api.post('/api/journal-entries', payload);
```

---

## ๐ ููุงุญุธุงุช ูุงูุฉ

1. **ุงููููุฏ ุงูููููุฉ:**
   - โ ุฑูู ุงูููุฏ ูููุฏ ุชููุงุฆูุงู - **ูุง ุชุญุชุงุฌ ุฅุถุงูุฉ ุฃู ููุฏ**
   - โ ูุนุงุฏ ุงูุชุณูุณู ุณูููุงู
   - โ ูุฑูุฏ ูููุธู

2. **ุงูููุงุชูุฑ:**
   - โ ูู ููุน ูุงุชูุฑุฉ ูู ุชุณูุณู ูุณุชูู
   - โ๏ธ ุงูุชุณูุณู ูุง ูุนุงุฏ ุณูููุงู (ูุณุชูุฑ)
   - โ ูููุฏ ุชููุงุฆูุงู ุนูุฏ ุงูุฅูุดุงุก

3. **ุงูุญุณุงุจุงุช:**
   - โ ุงุณุชุฎุฏู API ููุญุตูู ุนูู ุงูุฑูู ุงูุชุงูู
   - โ๏ธ ุชุญูู ูู ุงูุณุนุฉ ุงููุชุงุญุฉ
   - โ ุงูุชุฑููู ูุฑูู ูููุธู

---

## ๐ ูููุงุช ูุฑุฌุนูุฉ

- **ูุธุงู ุงูุญุณุงุจุงุช:** `backend/NUMBERING_SYSTEM_SUMMARY.md`
- **ุดุฌุฑุฉ ุงูุญุณุงุจุงุช:** `backend/CHART_OF_ACCOUNTS.md`
- **ุชูููุฏ ุฃุฑูุงู ุงูุญุณุงุจุงุช:** `backend/account_number_generator.py`
- **ุฏููู ุงูุนููุงุก:** `backend/CUSTOMER_NUMBERING_GUIDE.md`
- **ุงููููุฏ ุงููุญุงุณุจูุฉ:** `backend/MELTING_RENEWAL_ACCOUNTING.md`

---

ุชู ุงูุชูุซูู ุจุชุงุฑูุฎ: 8 ููููุจุฑ 2025 โ
