# ุฅุตูุงุญ ูุดููุฉ ููุงุชูุฑ ุงูุดุฑุงุก ูู ุงูููุฑุฏ

## ๐ ููุฎุต ุงููุดููุฉ

ุนูุฏ ูุญุงููุฉ ุฅูุดุงุก ูุงุชูุฑุฉ "ุดุฑุงุก ุฐูุจ ุฌุฏูุฏ ูู ููุฑุฏ" ูู ุฎูุงู ุชุทุจูู Flutterุ ูุงู ูุธูุฑ ุงูุฎุทุฃ ุงูุชุงูู:
```
Failed to create invoice. Status: 400
```

## ๐ ุงูุชุดุฎูุต

ุชู ุชุชุจุน ุงููุดููุฉ ุฅูู ุฌุฐูุฑูุง ููุฌุฏ ุฃู ููุงู **ูุดููุชูู ุฃุณุงุณูุชูู**:

### ุงููุดููุฉ ุงูุฃููู: ููุน ุงููุงุชูุฑุฉ ุบูุฑ ุฏููู
- **ุงูุฃุนุฑุงุถ**: Flutter ูุฑุณู `invoice_type = 'ุดุฑุงุก'` (ุนุงู ูุบูุฑ ูุญุฏุฏ)
- **ุงููุชููุน**: ุงูุฎุงุฏู ูุญุชุงุฌ `invoice_type = 'ุดุฑุงุก'` (ูุญุฏุฏ) ูููุงุชูุฑ ุดุฑุงุก ุงูุฐูุจ ุงูุฌุฏูุฏ
- **ุงูุณุจุจ**: ุนุฏู ุชุญููู ุชููุงุฆู ุจูู ุงูุฃููุงุน ุงูุนุงูุฉ ูุงููุญุฏุฏุฉ

### ุงููุดููุฉ ุงูุซุงููุฉ: ุงุณุชุฎุฏุงู customer_id ุจุฏูุงู ูู supplier_id
- **ุงูุฃุนุฑุงุถ**: Flutter ูุฑุณู `customer_id` ุญุชู ุนูุฏ ุงูุชุนุงูู ูุน ููุฑุฏ
- **ุงููุชููุน**: ููุงุชูุฑ "ุดุฑุงุก" ุชุญุชุงุฌ `supplier_id`
- **ุงูุณุจุจ**: ุชุตููู ุงููุงุฌูุฉ ูุณุชุฎุฏู ููุณ ุงูุญูู ููุนููู ูุงูููุฑุฏ

## โ ุงูุญููู ุงููุทุจูุฉ

### ุงูุญู 1: ุชุญููู ููุน ุงููุงุชูุฑุฉ ุงูุชููุงุฆู
```python
elif invoice_type == 'ุดุฑุงุก':
    # ุชุญููู 'ุดุฑุงุก' ุงูุนุงู ุฅูู ููุน ูุญุฏุฏ ุจูุงุกู ุนูู gold_type
    if gold_type == 'new':
        invoice_type = 'ุดุฑุงุก'
    else:
        invoice_type = 'ุดุฑุงุก ูู ุนููู'
```

**ุงููุงุฆุฏุฉ**: ูุญุฏุฏ ููุน ุงูุดุฑุงุก ุชููุงุฆูุงู ุจูุงุกู ุนูู ููุน ุงูุฐูุจ (`new` ุฃู `scrap`).

### ุงูุญู 2: ุชุญููู customer_id ุฅูู supplier_id
```python
if gold_type == 'new':
    invoice_type = 'ุดุฑุงุก'
    # ููู customer_id ุฅูู supplier_id ุฅุฐุง ูู ููู supplier_id ููุฌูุฏุงู
    if not data.get('supplier_id') and data.get('customer_id'):
        data['supplier_id'] = data.pop('customer_id')
```

**ุงููุงุฆุฏุฉ**: ูุตุญุญ ุงูุจูุงูุงุช ุงููุงุฑุฏุฉ ูู Flutter ุชููุงุฆูุงูุ ููุง ูุณูุญ ุจุงุณุชุฎุฏุงู ููุณ ุงููุงุฌูุฉ ููุนููุงุก ูุงูููุฑุฏูู.

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงูุทุฑููุฉ 1: ุนุจุฑ Flutter
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงูุชูู ุฅูู "ูุงุชูุฑุฉ ุดุฑุงุก ููุต ุฌุฏูุฏุฉ"
3. ุงููุฃ ุงูุจูุงูุงุช:
   - ุงุฎุชุฑ ุงูููุฑุฏ
   - ุฃุถู ุฃุตูุงู
   - ุญุฏุฏ ุงูุฃุณุนุงุฑ ูุงูุฃูุฒุงู
4. ุงุถุบุท "ุฅุตุฏุงุฑ ูุงุชูุฑุฉ ุงูุดุฑุงุก"
5. ูุฌุจ ุฃู ุชููุดุฃ ุงููุงุชูุฑุฉ ุจูุฌุงุญ

### ุงูุทุฑููุฉ 2: ุนุจุฑ API ูุจุงุดุฑุฉ
```bash
curl -X POST http://localhost:8001/api/invoices \
  -H "Content-Type: application/json" \
  -d '{
    "invoice_type": "ุดุฑุงุก",
    "transaction_type": "buy",
    "gold_type": "new",
    "customer_id": 1,
    "date": "2025-11-30T14:00:00",
    "total": 5000,
    "items": [
      {
        "name": "ุฎุงุชู ุฐูุจ 21",
        "karat": 21,
        "weight": 10,
        "wage": 20,
        "quantity": 1,
        "price": 5000,
        "net": 4500,
        "tax": 500
      }
    ],
    "total_cost": 0,
    "total_tax": 500,
    "total_weight": 10
  }'
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: 
- Status Code: `201`
- ุงููุงุชูุฑุฉ ุชููุดุฃ ุจูุฌุงุญ
- `invoice_type` ูู ุงูุฑุฏ: `"ุดุฑุงุก"`
- `supplier_id` ูู ุงูุฑุฏ: `1` (ูุญูู ูู customer_id)

## ๐ ููุงุญุธุงุช ุชูููุฉ

### ุฃููุงุน ุงูููุงุชูุฑ ุงููุฏุนููุฉ
| ุงูููุน ูู Flutter | ุงูููุน ุจุนุฏ ุงูุชุญููู | ุงูุดุฑุท |
|------------------|-------------------|-------|
| `ุดุฑุงุก` + `gold_type=new` | `ุดุฑุงุก` | ุฐูุจ ุฌุฏูุฏ |
| `ุดุฑุงุก` + `gold_type=scrap` | `ุดุฑุงุก ูู ุนููู` | ุฐูุจ ูุณุฑ |
| `ุจูุน` | `ุจูุน` | ุฏูู ุชุบููุฑ |

### ุงููููุฏ ุงููุญุงุณุจูุฉ ูู "ุดุฑุงุก"
ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุดุฑุงุกุ ูุชู ุฅูุดุงุก ุงููููุฏ ุงูุชุงููุฉ ุชููุงุฆูุงู:

1. **ุฅุซุจุงุช ุงููุฎุฒูู** (ูุฏูู):
   - ุงูุญุณุงุจ: ูุฎุฒูู ุงูุฐูุจ ุนูุงุฑ XX
   - ุงููููุฉ: ุฅุฌูุงูู ุงููุงุชูุฑุฉ (ููุฏ + ูุฒู)

2. **ุงูููุฑุฏ ุฏุงุฆู**:
   - ุงูุญุณุงุจ: ุญุณุงุจ ุงูููุฑุฏ
   - ุงููููุฉ: ุฅุฌูุงูู ุงููุงุชูุฑุฉ (ููุฏ ููุท)

3. **ุงูุถุฑูุจุฉ** (ุฅู ูุฌุฏุช):
   - ุงูุญุณุงุจ: ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ ุงููุฏููุนุฉ
   - ุงููููุฉ: ุฅุฌูุงูู ุงูุถุฑูุจุฉ

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

1. **Frontend**: ุชุนุฏูู Flutter ูุฅุฑุณุงู `supplier_id` ูุจุงุดุฑุฉ ููููุฑุฏูู
2. **Validation**: ุฅุถุงูุฉ ุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู ุงูุฅุฑุณุงู
3. **Error Messages**: ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ ูุชููู ุฃูุซุฑ ูุถูุญุงู (ุนุฑุจู ูุฅูุฌููุฒู)
4. **Logging**: ุฅุถุงูุฉ ุณุฌูุงุช ุชูุตูููุฉ ูุชุชุจุน ุงูุชุญูููุงุช

## โ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

- [x] ุชุญุฏูุฏ ููุน ุงููุงุชูุฑุฉ ุชููุงุฆูุงู
- [x] ุชุญููู customer_id ุฅูู supplier_id ุนูุฏ ุงูุญุงุฌุฉ
- [x] ุงุฎุชุจุงุฑ ุนุจุฑ API
- [ ] ุงุฎุชุจุงุฑ ุนุจุฑ Flutter (ูุชุทูุจ ุชุฃููุฏ ุงููุณุชุฎุฏู)
- [ ] ุชุญุฏูุซ ูุซุงุฆู API

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: 30 ููููุจุฑ 2025  
**ุงููููุงุช ุงููุนุฏูุฉ**: `backend/routes.py` (ุณุทูุฑ 1326-1348)
