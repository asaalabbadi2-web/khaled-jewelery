# ุฅุตูุงุญ ูุดุงูู ูุณุงุฆู ุงูุฏูุน ูู ุดุงุดุฉ ุงููุจูุนุงุช

## ๐ด ุงููุดุงูู ุงููููุชุดูุฉ

### 1. ุนุฑุถ ุฌููุน ูุณุงุฆู ุงูุฏูุน (ุงููุดุทุฉ ูุบูุฑ ุงููุดุทุฉ)
**ุงููุดููุฉ**: ูุงูุช ุงูุดุงุดุฉ ุชุณุชุฎุฏู `getPaymentMethods()` ุงูุฐู ููุฑุฌุน **ุฌููุน** ูุณุงุฆู ุงูุฏูุน ุจุฏูู ุชุตููุฉ.

**ุงูููุฏ ุงููุฏูู (ุฎุงุทุฆ)**:
```dart
final methods = await apiService.getPaymentMethods();
```

**ุงูุญู (ุตุญูุญ)**:
```dart
final methods = await apiService.getActivePaymentMethods();  // โ ููุท ุงููุดุทุฉ
```

**ุงูููู**: `frontend/lib/screens/sales_invoice_screen_v2.dart` - ุงูุณุทุฑ 79

---

### 2. ุนุฏู ุญุณุงุจ ุงูุนูููุฉ ุจุดูู ุตุญูุญ
**ุงููุดููุฉ**: ูุงู ุงูููุฏ ูุจุญุซ ุนู ุญูู `commission` ุจูููุง ุงูุญูู ุงูุตุญูุญ ูู `commission_rate`.

**ุงูููุฏ ุงููุฏูู (ุฎุงุทุฆ)**:
```dart
final rate = method['commission'] ?? 0.0;  // โ ุญูู ุฎุงุทุฆ
```

**ุงูุญู (ุตุญูุญ)**:
```dart
final rate = (method['commission_rate'] ?? 0.0) is String 
    ? double.tryParse(method['commission_rate'].toString()) ?? 0.0
    : (method['commission_rate'] ?? 0.0).toDouble();
```

**ุงูููู**: `frontend/lib/screens/sales_invoice_screen_v2.dart` - ุงูุณุทุฑ 132

---

### 3. ุถุฑูุจุฉ ุงูุนูููุฉ (VAT on Commission)
**ุงููุถุน**: ูุงู ููุฌูุฏุงู ูุตุญูุญ โ

ุงูููุฏ ูุญุณุจ ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ ุนูู ุงูุนูููุฉ ุจุดูู ุตุญูุญ:
```dart
final commissionVat = double.parse((commission * 0.15).toStringAsFixed(2));
```

---

## โ ุงูุฅุตูุงุญุงุช ุงูููููุฐุฉ

### ุงูุชุบููุฑ 1: ุงุณุชุฎุฏุงู ูุณุงุฆู ุงูุฏูุน ุงููุดุทุฉ ููุท
```dart
// โ ูุจู
final methods = await apiService.getPaymentMethods();

// โ ุจุนุฏ
final methods = await apiService.getActivePaymentMethods();
```

### ุงูุชุบููุฑ 2: ุฅุตูุงุญ ูุฑุงุกุฉ ูุณุจุฉ ุงูุนูููุฉ
```dart
// โ ูุจู
final rate = method['commission'] ?? 0.0;

// โ ุจุนุฏ
final rate = (method['commission_rate'] ?? 0.0) is String 
    ? double.tryParse(method['commission_rate'].toString()) ?? 0.0
    : (method['commission_rate'] ?? 0.0).toDouble();
```

---

## ๐ ููููุฉ ุนูู ุญุณุงุจ ุงูุนูููุฉ

### ุงููุนุงุฏูุงุช:
1. **ุงูุนูููุฉ** = `ุงููุจูุบ ร (ูุณุจุฉ_ุงูุนูููุฉ รท 100)`
2. **ุถุฑูุจุฉ ุงูุนูููุฉ (VAT)** = `ุงูุนูููุฉ ร 0.15` (15%)
3. **ุงูุตุงูู ุงููุณุชูู** = `ุงููุจูุบ - ุงูุนูููุฉ - ุถุฑูุจุฉ_ุงูุนูููุฉ`

### ูุซุงู ุนููู:
```
ุงููุจูุบ ุงููุฏููุน: 1000 ุฑ.ุณ
ูุณุจุฉ ุงูุนูููุฉ: 2.5%

ุงูุนูููุฉ = 1000 ร (2.5 รท 100) = 25 ุฑ.ุณ
ุถุฑูุจุฉ ุงูุนูููุฉ = 25 ร 0.15 = 3.75 ุฑ.ุณ
ุงูุตุงูู ุงููุณุชูู = 1000 - 25 - 3.75 = 971.25 ุฑ.ุณ
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. โ ุงูุชุญ ุดุงุดุฉ ูุงุชูุฑุฉ ุงูุจูุน
2. โ ุชุญูู ุฃู ูุงุฆูุฉ ูุณุงุฆู ุงูุฏูุน ุชุนุฑุถ **ููุท ุงููุดุทุฉ**
3. โ ุฃุถู ูุณููุฉ ุฏูุน ุจุนูููุฉ (ูุซู: ูุฏู 2.5%)
4. โ ุชุญูู ูู ุญุณุงุจ:
   - ุงูุนูููุฉ
   - ุถุฑูุจุฉ ุงูุนูููุฉ (15%)
   - ุงูุตุงูู ุงููุณุชูู
5. โ ุชุญูู ูู ุญูุธ ุงููุงุชูุฑุฉ ุจูุฌุงุญ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุงุฆูุฉ ูุณุงุฆู ุงูุฏูุน ุชุนุฑุถ ููุท ุงููุณุงุฆู ุงููุดุทุฉ โ
- ุงูุนูููุฉ ุชูุญุณุจ ุจุดูู ุตุญูุญ ุญุณุจ ูุณุจุฉ ูู ูุณููุฉ โ
- ุถุฑูุจุฉ ุงูุนูููุฉ (15%) ุชูุญุณุจ ูุชูุนุฑุถ โ
- ุงูุตุงูู ุงููุณุชูู = ุงููุจูุบ - ุงูุนูููุฉ - ุถุฑูุจุฉ ุงูุนูููุฉ โ

---

## ๐ ุงููููุงุช ุงูููุนุฏููุฉ

1. **`frontend/lib/screens/sales_invoice_screen_v2.dart`**
   - ุงูุณุทุฑ 79: ุชุบููุฑ ูู `getPaymentMethods()` ุฅูู `getActivePaymentMethods()`
   - ุงูุณุทุฑ 132-136: ุฅุตูุงุญ ูุฑุงุกุฉ `commission_rate` ูุน ูุนุงูุฌุฉ String/double

---

## ๐ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

- **API Service**: `frontend/lib/api_service.dart`
  - `getActivePaymentMethods()` - ุฌูุจ ุงููุณุงุฆู ุงููุดุทุฉ ููุท
  - `getPaymentMethods()` - ุฌูุจ ุฌููุน ุงููุณุงุฆู
  
- **Backend**: `backend/routes.py`
  - `/api/payment-methods` - ุฌููุน ุงููุณุงุฆู
  - `/api/payment-methods/active` - ุงููุดุทุฉ ููุท

- **Models**: `backend/models.py`
  - `PaymentMethod` - ูุญุชูู ุนูู `commission_rate`, `is_active`, `settlement_days`

---

ุชุงุฑูุฎ: 14 ุฃูุชูุจุฑ 2025
