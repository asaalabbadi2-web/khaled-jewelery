# ูุธุงู ุงูุฑุจุท ุงููุญุงุณุจู (Accounting Mapping System)

## ๐### ุงุณุชุฎุฏุงู API ูุฅุถุงูุฉ ุงูุฅุนุฏุงุฏุงุช

ููููู ุฅุถุงูุฉ ุงูุฅุนุฏุงุฏุงุช ุงููุญุงุณุจูุฉ ุนุจุฑ API ูุจุงุดุฑุฉู:

```bash
# ูุซุงู: ุฅุถุงูุฉ ุญุณุงุจ ุงูุนููุงุก ูุนูููุงุช ุงูุจูุน
curl -X POST http://localhost:8001/api/accounting-mappings \
  -H "Content-Type: application/json" \
  -d '{
    "operation_type": "ุจูุน",
    "account_type": "customers",
    "account_id": 5,
    "account_name": "ุงูุนููุงุก"
  }'

# ุนุฑุถ ุฌููุน ุงูุฅุนุฏุงุฏุงุช
curl http://localhost:8001/api/accounting-mappings

# ุญุฐู ุฅุนุฏุงุฏ ูุนูู
curl -X DELETE http://localhost:8001/api/accounting-mappings/1
```

> โ๏ธ **ููุงุญุธุฉ**: ุงูุณูุฑูุจุช `init_accounting_mappings.py` ูุญุชุงุฌ ุฅุตูุงุญ Flask app context. ุงุณุชุฎุฏู API ุจุฏูุงู ููู ุญุงููุงู.ุฑู ูุฑุจุท ุนูููุงุช ุงูููุงุชูุฑ ุจุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉุ ูุณูุญ ุจุชุฎุตูุต ุงูุญุณุงุจุงุช ุญุณุจ ููุน ุงูุนูููุฉ ูุงูุนูุงุฑ.

---

## โจ ุงููููุฒุงุช

### 1. **ุฑุจุท ุฏููุงูููู**
- ุฑุจุท ูู ููุน ุนูููุฉ (ุจูุนุ ุดุฑุงุกุ ูุฑุชุฌุน...) ุจุญุณุงุจุงุช ูุญุงุณุจูุฉ ูุฎุตุตุฉ
- ุฏุนู 15+ ููุน ุญุณุงุจ ูุฎุชูู
- ุฅููุงููุฉ ุชุฎุตูุต ุญุณุงุจุงุช ุงููุฎุฒูู ุญุณุจ ุงูุนูุงุฑ (18ุ 21ุ 22ุ 24)

### 2. **ูุธุงู Fallback**
- ุฅุฐุง ูู ูุชู ุชูููู ุงูุฅุนุฏุงุฏุงุชุ ูุณุชุฎุฏู ุงููุธุงู ุญุณุงุจุงุช ุงูุชุฑุงุถูุฉ
- ุนุฏู ุงูุญุงุฌุฉ ููุฅุนุฏุงุฏ ุงูุฃููู - ูุนูู ูุจุงุดุฑุฉ
- ุฅููุงููุฉ ุงูุชุฎุตูุต ูุงุญูุงู ุนูุฏ ุงูุญุงุฌุฉ

### 3. **ุฃููุงุน ุงูุญุณุงุจุงุช ุงููุฏุนููุฉ**

#### ุงููุฎุฒูู (ุญุณุจ ุงูุนูุงุฑ)
- `inventory_18k` - ูุฎุฒูู ุฐูุจ ุนูุงุฑ 18 (ุงูุชุฑุงุถู: 120)
- `inventory_21k` - ูุฎุฒูู ุฐูุจ ุนูุงุฑ 21 (ุงูุชุฑุงุถู: 120)
- `inventory_22k` - ูุฎุฒูู ุฐูุจ ุนูุงุฑ 22 (ุงูุชุฑุงุถู: 120)
- `inventory_24k` - ูุฎุฒูู ุฐูุจ ุนูุงุฑ 24 (ุงูุชุฑุงุถู: 120)

#### ุงูููุฏูุฉ ูุงูุจููู
- `cash` - ุงูุตูุฏูู/ุงูููุฏูุฉ (ุงูุชุฑุงุถู: 101)

#### ุงูุนููุงุก ูุงูููุฑุฏูู
- `customers` - ุญุณุงุจ ุงูุนููุงุก ุงูุชุฌููุนู (ุงูุชุฑุงุถู: 1100)
- `suppliers` - ุญุณุงุจ ุงูููุฑุฏูู ุงูุชุฌููุนู (ุงูุชุฑุงุถู: 211)

#### ุงูุฅูุฑุงุฏุงุช ูุงูุชูุงููู
- `revenue` - ุงูุฅูุฑุงุฏุงุช (ุงูุชุฑุงุถู: 4)
- `cost` - ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ (ุงูุชุฑุงุถู: 120)

#### ุงูุนูููุงุช
- `commission` - ูุตุฑูู ุงูุนูููุงุช (ุงูุชุฑุงุถู: 5200)
- `commission_vat` - ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ ุนูู ุงูุนูููุงุช (ุงูุชุฑุงุถู: 1303)

#### ุงูุถุฑุงุฆุจ
- `vat_payable` - ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ ุงููุณุชุญูุฉ - ุฏุงุฆูุฉ (ุงูุชุฑุงุถู: 2101)
- `vat_receivable` - ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ ุงููุฏููุนุฉ - ูุฏููุฉ (ุงูุชุฑุงุถู: 1303)

#### ุญุณุงุจุงุช ุฅุถุงููุฉ
- `profit_loss` - ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ (ุงูุชุฑุงุถู: 3)
- `sales_returns` - ูุฑุฏูุฏุงุช ุงููุจูุนุงุช (ุงูุชุฑุงุถู: 401)
- `purchase_returns` - ูุฑุฏูุฏุงุช ุงููุดุชุฑูุงุช (ุงูุชุฑุงุถู: 501)

---

## ๐ ุงูุงุณุชุฎุฏุงู

### Backend

#### 1. ุฅูุดุงุก ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ
```bash
cd backend
source venv/bin/activate
python init_accounting_mappings.py create
```

#### 2. ุนุฑุถ ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ
```bash
python init_accounting_mappings.py list
```

#### 3. ุญุฐู ุฌููุน ุงูุฅุนุฏุงุฏุงุช (ููุงุฎุชุจุงุฑ)
```bash
python init_accounting_mappings.py clear
```

#### 4. ุงุณุชุฎุฏุงู ูู ุงูููุฏ
```python
from backend.routes import get_account_id_for_mapping

# ุงูุญุตูู ุนูู ุญุณุงุจ ุงููุฎุฒูู ููุงุชูุฑุฉ ุจูุน
inventory_account_id = get_account_id_for_mapping('ุจูุน', 'inventory_21k')

# ุงูุญุตูู ุนูู ุญุณุงุจ ุงูููุฏูุฉ
cash_account_id = get_account_id_for_mapping('ุจูุน', 'cash')
```

### Frontend

#### 1. ูุชุญ ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช
```
ุงูุชุทุจูู โ ุงูุฅุนุฏุงุฏุงุช โ๏ธ โ ุชุจููุจ "ุฑุจุท ูุญุงุณุจู" โ ูุชุญ ุฅุนุฏุงุฏุงุช ุงูุฑุจุท ุงููุญุงุณุจู
```

#### 2. ุชุฎุตูุต ุงูุฑุจุท
1. ุงุฎุชุฑ ููุน ุงูุนูููุฉ (ุจูุนุ ุดุฑุงุกุ ูุฑุชุฌุน...)
2. ุญุฏุฏ ุงูุญุณุงุจ ุงููุญุงุณุจู ููู ููุน (ูุฎุฒููุ ููุฏูุฉุ ุฅูุฑุงุฏุงุช...)
3. ุงูุญูุธ ุชููุงุฆู ุนูุฏ ุงูุชุบููุฑ

---

## ๐ ุงูุจููุฉ ุงูุชูููุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุฌุฏูู `accounting_mapping`
```sql
CREATE TABLE accounting_mapping (
    id INTEGER PRIMARY KEY,
    operation_type VARCHAR(50) NOT NULL,  -- ููุน ุงูุนูููุฉ
    account_type VARCHAR(50) NOT NULL,    -- ููุน ุงูุญุณุงุจ
    account_id INTEGER NOT NULL,          -- ูุนุฑู ุงูุญุณุงุจ ุงููุญุงุณุจู
    allocation_percentage FLOAT,          -- ูุณุจุฉ ุงูุชุฎุตูุต (ุงุฎุชูุงุฑู)
    description TEXT,                     -- ุงูุจูุงู
    is_active BOOLEAN DEFAULT 1,          -- ุญุงูุฉ ุงูุชูุนูู
    created_by VARCHAR(100),              -- ุงูููุดุฆ
    created_at DATETIME,                  -- ุชุงุฑูุฎ ุงูุฅูุดุงุก
    updated_at DATETIME,                  -- ุชุงุฑูุฎ ุงูุชุญุฏูุซ
    UNIQUE(operation_type, account_type)
);
```

### API Endpoints

#### GET `/api/accounting-mappings`
ุงูุญุตูู ุนูู ุฌููุน ุฅุนุฏุงุฏุงุช ุงูุฑุจุท

**Query Parameters:**
- `operation_type` (optional): ุชุตููุฉ ุญุณุจ ููุน ุงูุนูููุฉ

**Response:**
```json
[
  {
    "id": 1,
    "operation_type": "ุจูุน",
    "account_type": "inventory_21k",
    "account_id": 120,
    "account_number": "120",
    "account_name": "ุงููุฎุฒูู",
    "is_active": true
  }
]
```

#### POST `/api/accounting-mappings`
ุฅูุดุงุก ุฃู ุชุญุฏูุซ ุฅุนุฏุงุฏ ุฑุจุท

**Request Body:**
```json
{
  "operation_type": "ุจูุน",
  "account_type": "inventory_21k",
  "account_id": 120,
  "description": "ูุฎุฒูู ุงูุฐูุจ ุนูุงุฑ 21 ูููุจูุนุงุช",
  "is_active": true
}
```

#### POST `/api/accounting-mappings/batch`
ุฅูุดุงุก ุนุฏุฉ ุฅุนุฏุงุฏุงุช ุฏูุนุฉ ูุงุญุฏุฉ

**Request Body:**
```json
{
  "mappings": [
    {
      "operation_type": "ุจูุน",
      "account_type": "inventory_21k",
      "account_id": 120
    },
    {
      "operation_type": "ุจูุน",
      "account_type": "cash",
      "account_id": 101
    }
  ]
}
```

#### DELETE `/api/accounting-mappings/{id}`
ุญุฐู ุฅุนุฏุงุฏ ุฑุจุท

#### POST `/api/accounting-mappings/get-account`
ุงูุญุตูู ุนูู ุงูุญุณุงุจ ุงููุฑุชุจุท ูุนูููุฉ ูุนููุฉ

**Request Body:**
```json
{
  "operation_type": "ุจูุน",
  "account_type": "inventory_21k"
}
```

---

## ๐ฏ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุชุฎุตูุต ุญุณุงุจุงุช ุงููุฎุฒูู ุญุณุจ ุงูุนูุงุฑ

```python
# ุฅุนุฏุงุฏ ุญุณุงุจุงุช ูุฎุฒูู ูููุตูุฉ ููู ุนูุงุฑ
mappings = [
    {'operation_type': 'ุจูุน', 'account_type': 'inventory_18k', 'account_id': 120},
    {'operation_type': 'ุจูุน', 'account_type': 'inventory_21k', 'account_id': 121},
    {'operation_type': 'ุจูุน', 'account_type': 'inventory_22k', 'account_id': 122},
    {'operation_type': 'ุจูุน', 'account_type': 'inventory_24k', 'account_id': 123},
]
```

### ูุซุงู 2: ุญุณุงุจุงุช ูููุตูุฉ ููุฐูุจ ุงูุฌุฏูุฏ ูุงููุณุฑ

```python
# ููุฐูุจ ุงูุฌุฏูุฏ
{'operation_type': 'ุจูุน', 'account_type': 'inventory_21k', 'account_id': 120}

# ููุฐูุจ ุงููุณุฑ
{'operation_type': 'ุดุฑุงุก ูู ุนููู', 'account_type': 'inventory_21k', 'account_id': 125}
```

### ูุซุงู 3: ุญุณุงุจุงุช ุนููุงุก ูููุตูุฉ ุญุณุจ ุงููุฆุฉ

```python
# ุนููุงุก ุฃูุฑุงุฏ
{'operation_type': 'ุจูุน', 'account_type': 'customers', 'account_id': 1100}

# ุนููุงุก ุฌููุฉ
{'operation_type': 'ุจูุน', 'account_type': 'customers', 'account_id': 1110}
```

---

## ๐ง ุงูุตูุงูุฉ

### ุฅุถุงูุฉ ููุน ุญุณุงุจ ุฌุฏูุฏ

1. **Backend** - ุฃุถู ูู `models.py`:
```python
# ูู ุชุนูููุงุช account_type
# - 'new_account_type': ูุตู ุงูุญุณุงุจ ุงูุฌุฏูุฏ
```

2. **Backend** - ุฃุถู ูู `routes.py` ุฏุงูุฉ `get_account_id_for_mapping()`:
```python
DEFAULT_ACCOUNTS = {
    # ... ุงูุญุณุงุจุงุช ุงูููุฌูุฏุฉ
    'new_account_type': 999,  # ุงูุญุณุงุจ ุงูุงูุชุฑุงุถู
}
```

3. **Frontend** - ุฃุถู ูู `accounting_mapping_screen.dart`:
```dart
final Map<String, String> _accountTypes = {
  // ... ุงูุฃููุงุน ุงูููุฌูุฏุฉ
  'new_account_type': 'ุงุณู ุงูุญุณุงุจ ุงูุฌุฏูุฏ',
};
```

### ุชุญุฏูุซ ุงูุญุณุงุจุงุช ุงูุงูุชุฑุงุถูุฉ

ุนุฏูู ุงููุงููุณ `DEFAULT_ACCOUNTS` ูู:
- `backend/routes.py` (ุฏุงูุฉ `get_account_id_for_mapping`)
- `backend/init_accounting_mappings.py` (ูุงููุณ `DEFAULT_MAPPINGS`)

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูุงูููุฉ**: ุงููุธุงู ูุนูู ุจุฏูู ุฅุนุฏุงุฏ - ูุณุชุฎุฏู ุงูุญุณุงุจุงุช ุงูุงูุชุฑุงุถูุฉ
2. **ุงููุฑููุฉ**: ูููู ุชุฎุตูุต ุฃู ุญุณุงุจ ูู ุฃู ููุช
3. **ุงููููุฏ**: constraint ูุฑูุฏ ุนูู `(operation_type, account_type)` - ูุง ูููู ุชูุฑุงุฑ ููุณ ุงูุฑุจุท
4. **ุงูุฃุฏุงุก**: ุงูุงุณุชุนูุงูุงุช ูุญุณููุฉ ุจู indexes ุนูู ุงูุญููู ุงููุณุชุฎุฏูุฉ ุจูุซุฑุฉ

---

## ๐ ุฎุทุท ูุณุชูุจููุฉ

- [ ] ุฏุนู ูุณุจ ุงูุชุฎุตูุต (80% ูุฎุฒููุ 20% ุฅูุฑุงุฏุงุช)
- [ ] ุชูุงุฑูุฑ ุงูุฑุจุท ุงููุญุงุณุจู
- [ ] ุงุณุชูุฑุงุฏ/ุชุตุฏูุฑ ุงูุฅุนุฏุงุฏุงุช
- [ ] ููุงูุจ ุฌุงูุฒุฉ ูุฃููุงุน ุงูุฃุนูุงู ุงููุฎุชููุฉ
- [ ] ุณุฌู ุงูุชุบููุฑุงุช (Audit Log)

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "ูุง ููุฌุฏ ุฑุจุท ูุญุงุณุจู ููุฐู ุงูุนูููุฉ"
**ุงูุญู**: ุงููุธุงู ุณูุณุชุฎุฏู ุงูุญุณุงุจุงุช ุงูุงูุชุฑุงุถูุฉ ุชููุงุฆูุงู

### ุงููุดููุฉ: "ุงูุญุณุงุจ ุงููุญุงุณุจู ุบูุฑ ููุฌูุฏ"
**ุงูุญู**: ุชุฃูุฏ ูู ุฅูุดุงุก ุงูุญุณุงุจ ูู ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุฃููุงู

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุชุบููุฑุงุช ุจุนุฏ ุงูุชุนุฏูู
**ุงูุญู**: ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู ุฃู ูู ุจู Hot Reload

---

ุชู ุงูุชูุซูู ุจูุงุณุทุฉ ูุธุงู Yasar POS โจ
