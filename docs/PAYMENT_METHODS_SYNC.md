# ๐ ุชุญุฏูุซ ุชุฑุชูุจ ุทุฑู ุงูุฏูุน ูู ูุงุชูุฑุฉ ุงููุจูุนุงุช

## ๐ ุงููุฏู
ุฌุนู ุชุฑุชูุจ ุทุฑู ุงูุฏูุน ูู ุดุงุดุฉ ูุงุชูุฑุฉ ุงููุจูุนุงุช ูุชุณูุงู ูุน ุชุฑุชูุจูุง ูู ุดุงุดุฉ ุฅุนุฏุงุฏุงุช ุทุฑู ุงูุฏูุน.

---

## โจ ุงูุชุญุฏูุซุงุช ุงููููุฐุฉ

### 1๏ธโฃ **ุชุญููู ุทุฑู ุงูุฏูุน ูู API** โ

#### ูุจู ุงูุชุญุฏูุซ โ:
```dart
// ููู ุซุงุจุชุฉ ููุชูุจุฉ ูู ุงูููุฏ
items: const [
  DropdownMenuItem(value: 'cash', child: Text('ููุฏู')),
  DropdownMenuItem(value: 'credit', child: Text('ุดุจูุฉ')),
  DropdownMenuItem(value: 'bank_transfer', child: Text('ุชุญููู ุจููู')),
],
```

**ุงููุดุงูู:**
- โ ููู ุซุงุจุชุฉ ูุง ุชุชุบูุฑ
- โ ูุง ุชุชุทุงุจู ูุน ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุง ูููู ุฅุถุงูุฉ/ุชุนุฏูู ุทุฑู ุงูุฏูุน
- โ ุชุฑุชูุจ ุนุดูุงุฆู

#### ุจุนุฏ ุงูุชุญุฏูุซ โ:
```dart
// ุชุญููู ุฏููุงูููู ูู API
List<Map<String, dynamic>> _paymentMethods = [];

Future<void> _loadPaymentMethods() async {
  final response = await ApiService().getActivePaymentMethods();
  setState(() {
    _paymentMethods = List<Map<String, dynamic>>.from(response);
    
    // ุชุฑุชูุจ ูุชุณู ูุน ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช
    _paymentMethods.sort((a, b) {
      // ุงููุดุทุฉ ุฃููุงู
      final aActive = a['is_active'] ?? false;
      final bActive = b['is_active'] ?? false;
      if (aActive && !bActive) return -1;
      if (!aActive && bActive) return 1;
      
      // ุซู ุญุณุจ display_order
      final aOrder = a['display_order'] ?? 999;
      final bOrder = b['display_order'] ?? 999;
      return aOrder.compareTo(bOrder);
    });
  });
}

// ุนุฑุถ ุฏููุงูููู ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
items: _paymentMethods.map((method) {
  return DropdownMenuItem<String>(
    value: method['payment_type'],
    child: Text(method['name'] ?? method['payment_type']),
  );
}).toList(),
```

**ุงูููุงุฆุฏ:**
- โ ุชุญููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุฑุชูุจ ูุชุณู ูุน ุงูุฅุนุฏุงุฏุงุช
- โ ุฃุณูุงุก ูุฎุตุตุฉ (ูู ุงูุฅุนุฏุงุฏุงุช)
- โ ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุงูุชุนุฏูู

---

### 2๏ธโฃ **ุฎูุงุฑุฒููุฉ ุงูุชุฑุชูุจ ุงูููุญุฏุฉ** โ

#### ุงูุฎูุงุฑุฒููุฉ:
```dart
_paymentMethods.sort((a, b) {
  // ุงูุฎุทูุฉ 1: ุงููุดุทุฉ ุฃููุงู
  final aActive = a['is_active'] ?? false;
  final bActive = b['is_active'] ?? false;
  if (aActive && !bActive) return -1;  // a ูุดุทุฉุ b ูุนุทูุฉ โ a ุฃููุงู
  if (!aActive && bActive) return 1;   // a ูุนุทูุฉุ b ูุดุทุฉ โ b ุฃููุงู
  
  // ุงูุฎุทูุฉ 2: ุฅุฐุง ูุงูุช ููุณ ุงูุญุงูุฉุ ุฑุชุจ ุญุณุจ display_order
  final aOrder = a['display_order'] ?? 999;
  final bOrder = b['display_order'] ?? 999;
  return aOrder.compareTo(bOrder);
});
```

#### ูุซุงู ุนูู ุงูุชุฑุชูุจ:

**ุงูุจูุงูุงุช:**
```json
[
  {"name": "ุชุญููู ุจููู", "is_active": false, "display_order": 3},
  {"name": "ููุฏู", "is_active": true, "display_order": 1},
  {"name": "ุจุทุงูุฉ", "is_active": true, "display_order": 2},
  {"name": "ุดูู", "is_active": false, "display_order": 4}
]
```

**ุจุนุฏ ุงูุชุฑุชูุจ:**
```json
[
  {"name": "ููุฏู", "is_active": true, "display_order": 1},       // โ ูุดุทุฉ + ุชุฑุชูุจ 1
  {"name": "ุจุทุงูุฉ", "is_active": true, "display_order": 2},       // โ ูุดุทุฉ + ุชุฑุชูุจ 2
  {"name": "ุชุญููู ุจููู", "is_active": false, "display_order": 3}, // โญ ูุนุทูุฉ + ุชุฑุชูุจ 3
  {"name": "ุดูู", "is_active": false, "display_order": 4}         // โญ ูุนุทูุฉ + ุชุฑุชูุจ 4
]
```

---

### 3๏ธโฃ **ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ุงูุฐููุฉ** โ

```dart
// ุชุนููู ุทุฑููุฉ ุงูุฏูุน ุงูุงูุชุฑุงุถูุฉ ููุฃููู ูู ุงููุงุฆูุฉ
if (_paymentMethods.isNotEmpty) {
  paymentMethod = _paymentMethods.first['payment_type'] ?? 'cash';
}
```

**ุงูููุงุฆุฏ:**
- โ ุฏุงุฆูุงู ุชุฎุชุงุฑ ุฃูู ุทุฑููุฉ ูุดุทุฉ
- โ ุชุชุจุน ุชุฑุชูุจ ุงูุฅุนุฏุงุฏุงุช
- โ ุชููุงุฆูุฉ ุจุฏูู ุชุฏุฎู ุงููุณุชุฎุฏู

---

### 4๏ธโฃ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** โ

```dart
try {
  final response = await ApiService().getActivePaymentMethods();
  // ... ุงูุชุญููู ูุงูุชุฑุชูุจ
} catch (e) {
  print('Error loading payment methods: $e');
  // ููู ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ุงูุฎุทุฃ
  setState(() {
    _paymentMethods = [
      {'payment_type': 'cash', 'name': 'ููุฏู', 'is_active': true, 'display_order': 1},
      {'payment_type': 'credit_card', 'name': 'ุจุทุงูุฉ ุงุฆุชูุงู', 'is_active': true, 'display_order': 2},
      {'payment_type': 'bank_transfer', 'name': 'ุชุญููู ุจููู', 'is_active': true, 'display_order': 3},
    ];
  });
}
```

**ุงูููุงุฆุฏ:**
- โ ูุง ุชุชุนุทู ุงูุดุงุดุฉ ุนูุฏ ูุดู ุงูุชุญููู
- โ ููู ุงูุชุฑุงุถูุฉ ูุนูููุฉ
- โ ุชุณุฌูู ุงูุฎุทุฃ ููุชุชุจุน

---

## ๐ ุงูููุงุฑูุฉ: ูุจู ูุจุนุฏ

| ุงูููุฒุฉ | ูุจู | ุจุนุฏ |
|--------|-----|-----|
| ูุตุฏุฑ ุงูุจูุงูุงุช | ุซุงุจุช ูู ุงูููุฏ | API ุฏููุงูููู |
| ุงูุชุฑุชูุจ | ุนุดูุงุฆู | ููุณู ูุน ุงูุฅุนุฏุงุฏุงุช |
| ุงูุฃุณูุงุก | ููุชูุจุฉ ูู ุงูููุฏ | ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช |
| ุงูุชุญุฏูุซ | ูุชุทูุจ ุชุนุฏูู ุงูููุฏ | ุชููุงุฆู |
| ุงูุงุชุณุงู | ุบูุฑ ูุชุณู | ูุชุณู 100% |
| ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ | ุซุงุจุชุฉ (cash) | ุฃูู ุทุฑููุฉ ูุดุทุฉ |

---

## ๐ ุณูุฑ ุงูุนูู

### ุนูุฏ ูุชุญ ุดุงุดุฉ ุงููุงุชูุฑุฉ:

```
1. initState()
   โ
2. _loadPaymentMethods()
   โ
3. ApiService().getActivePaymentMethods()
   โ
4. ุงุณุชูุงู ุงูุจูุงูุงุช ูู ุงูุฎุงุฏู
   โ
5. ุงูุชุฑุชูุจ (ุงููุดุทุฉ ุฃููุงู ุซู display_order)
   โ
6. ุชุนููู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
   โ
7. ุจูุงุก ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
   โ
8. โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
```

### ุนูุฏ ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช:

```
ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช:
1. ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุทุฑููุฉ ุฏูุน
   โ
2. ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   โ
ุดุงุดุฉ ุงููุงุชูุฑุฉ ุงูุชุงููุฉ:
3. ุชุญููู ุงูุจูุงูุงุช ุงููุญุฏุซุฉ
   โ
4. ุชุฑุชูุจ ุญุณุจ ุงูููุงุนุฏ ุงูุฌุฏูุฏุฉ
   โ
5. โ ูุธูุฑ ุงูุชุฑุชูุจ ุงูุฌุฏูุฏ ุชููุงุฆูุงู
```

---

## ๐ก ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุชุฑุชูุจ ุจุณูุท

**ูู ุงูุฅุนุฏุงุฏุงุช:**
```
โฐ ๐ต ููุฏู          [ูุดุท] - ุงูุชุฑุชูุจ: 1
โฐ ๐ณ ุจุทุงูุฉ ุงุฆุชูุงู  [ูุดุท] - ุงูุชุฑุชูุจ: 2
โฐ ๐ฆ ุชุญููู ุจููู    [ูุดุท] - ุงูุชุฑุชูุจ: 3
```

**ูู ุงููุงุชูุฑุฉ:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ ุทุฑููุฉ ุงูุฏูุน        โ
โโโโโโโโโโโโโโโโโโโโโโโค
โ โบ ููุฏู            โ โ ุงูุชุฑุงุถู
โ   ุจุทุงูุฉ ุงุฆุชูุงู    โ
โ   ุชุญููู ุจููู      โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุซุงู 2: ูุน ุทุฑู ูุนุทูุฉ

**ูู ุงูุฅุนุฏุงุฏุงุช:**
```
โฐ ๐ณ ุจุทุงูุฉ         [ูุดุท]   - ุงูุชุฑุชูุจ: 1
โฐ ๐ต ููุฏู          [ูุดุท]   - ุงูุชุฑุชูุจ: 2
โฐ ๐ ุดูู           [ูุนุทู] - ุงูุชุฑุชูุจ: 3
โฐ ๐ฆ ุชุญููู ุจููู    [ูุนุทู] - ุงูุชุฑุชูุจ: 4
```

**ูู ุงููุงุชูุฑุฉ:**
```
โโโโโโโโโโโโโโโโโโโโโโโ
โ ุทุฑููุฉ ุงูุฏูุน        โ
โโโโโโโโโโโโโโโโโโโโโโโค
โ โบ ุจุทุงูุฉ           โ โ ุงูุชุฑุงุถู (ุฃูู ูุดุทุฉ)
โ   ููุฏู            โ
โโโโโโโโโโโโโโโโโโโโโโโ
```
*ููุงุญุธุฉ: ุงูุทุฑู ุงููุนุทูุฉ ูุง ุชุธูุฑ (getActivePaymentMethods)*

### ูุซุงู 3: ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุฑุชูุจ

**ูุจู ุงูุณุญุจ:**
```
ุงูุฅุนุฏุงุฏุงุช:          ุงููุงุชูุฑุฉ:
1. ููุฏู             โบ ููุฏู
2. ุจุทุงูุฉ               ุจุทุงูุฉ
3. ุชุญููู              ุชุญููู
```

**ุงููุณุชุฎุฏู ูุณุญุจ "ุชุญููู" ููุฃุนูู:**
```
ุงูุฅุนุฏุงุฏุงุช:          ุงููุงุชูุฑุฉ (ุงููุฑุฉ ุงููุงุฏูุฉ):
1. ุชุญููู            โบ ุชุญููู  โ ุงูุขู ุงูุชุฑุงุถู!
2. ููุฏู               ููุฏู
3. ุจุทุงูุฉ              ุจุทุงูุฉ
```

---

## ๐๏ธ ุงูุชูุงุตูู ุงูุชูููุฉ

### ููู: `add_invoice_screen.dart`

#### ุงููุชุบูุฑุงุช ุงููุถุงูุฉ:
```dart
List<Map<String, dynamic>> _paymentMethods = []; // ูุงุฆูุฉ ุทุฑู ุงูุฏูุน
```

#### ุงูุฏูุงู ุงููุถุงูุฉ:
```dart
Future<void> _loadPaymentMethods() async {
  // ุชุญููู ุทุฑู ุงูุฏูุน ุงููุดุทุฉ
  // ุชุฑุชูุจูุง ุญุณุจ ุงูููุงุนุฏ
  // ุชุนููู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
  // ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
}
```

#### ุงูุชุนุฏููุงุช:
```dart
// ูู initState()
_loadPaymentMethods(); // ุชุญููู ุทุฑู ุงูุฏูุน

// ูู _buildPaymentStep()
items: _paymentMethods.map((method) {
  return DropdownMenuItem<String>(
    value: method['payment_type'],
    child: Text(method['name'] ?? method['payment_type']),
  );
}).toList(),
```

### API ุงููุณุชุฎุฏูุฉ:
```dart
ApiService().getActivePaymentMethods()
// GET /api/payment-methods/active
// Returns: List<Map<String, dynamic>>
```

**ุญููู ุงูุจูุงูุงุช:**
- `id`: ูุนุฑู ุงูุทุฑููุฉ
- `payment_type`: ููุน ุงูุฏูุน (cash, credit_card, ...)
- `name`: ุงูุงุณู ุงููุฎุตุต
- `is_active`: ุญุงูุฉ ุงูุชูุนูู
- `display_order`: ุชุฑุชูุจ ุงูุนุฑุถ
- `commission_rate`: ูุณุจุฉ ุงูุนูููุฉ

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุชุฒุงูู:
- โ ูุชู ุชุญููู ุทุฑู ุงูุฏูุน ุนูุฏ ูุชุญ ุงูุดุงุดุฉ
- โ ุงูุชุญุฏูุซุงุช ุชุธูุฑ ูู ุงููุงุชูุฑุฉ ุงูุชุงููุฉ
- โ๏ธ ุฅุฐุง ูุงูุช ุงูุดุงุดุฉ ููุชูุญุฉุ ูู ุชุชุญุฏุซ ุญุชู ุฅุนุงุฏุฉ ุงููุชุญ

### 2. ุงูุฃุฏุงุก:
- โ ุชุญููู ูุงุญุฏ ุนูุฏ initState
- โ ูุง ุฅุนุงุฏุฉ ุชุญููู ุนูุฏ ูู ุชุบููุฑ
- โ Caching ูู ุงููุชุบูุฑ ุงููุญูู

### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
- โ ููู ุงูุชุฑุงุถูุฉ ุนูุฏ ูุดู ุงูุชุญููู
- โ ุฑุณุงูุฉ ูู Console ููุชุชุจุน
- โ ุงูุดุงุดุฉ ูุง ุชุชุนุทู ุฃุจุฏุงู

### 4. ุงูุงุชุณุงู:
- โ ููุณ ุฎูุงุฑุฒููุฉ ุงูุชุฑุชูุจ ูู ููุง ุงูุดุงุดุชูู
- โ ููุณ ูุตุฏุฑ ุงูุจูุงูุงุช (API)
- โ ููุณ ุงูููุงุนุฏ (ูุดุทุฉ ุฃููุงู + display_order)

---

## ๐ฏ ูุชุงุฆุฌ ุงูุชุญุฏูุซ

### ุงูุงุชุณุงู:
| ุงูุดุงุดุฉ | ุงูุชุฑุชูุจ | ุงููุตุฏุฑ |
|--------|---------|--------|
| ุฅุนุฏุงุฏุงุช ุทุฑู ุงูุฏูุน | ูุดุทุฉ ุฃููุงู + display_order | API |
| ูุงุชูุฑุฉ ุงููุจูุนุงุช | ูุดุทุฉ ุฃููุงู + display_order | API |
| **ุงูุงุชุณุงู** | โ 100% | โ ููุณ ุงููุตุฏุฑ |

### ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:
- โ ุชุฑุชูุจ ูุชููุน ูููุทูู
- โ ูุง ุญุงุฌุฉ ูุชุฐูุฑ ุฃู ุดูุก
- โ ูุง ุชุฑุงู ูู ุงูุฅุนุฏุงุฏุงุช = ูุง ุชุฑุงู ูู ุงููุงุชูุฑุฉ
- โ ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ุฏุงุฆูุงู ููุทููุฉ

### ุณูููุฉ ุงูุตูุงูุฉ:
- โ ููุฏ ููุญุฏ
- โ ูุง ุชูุฑุงุฑ
- โ ุณูู ุงูุชุนุฏูู
- โ ูุงุจู ููุชูุณุน

---

## โ ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ

### ุงูุณููุงุฑูู 1: ูุชุญ ุงููุงุชูุฑุฉ
- [x] ูุชู ุชุญููู ุทุฑู ุงูุฏูุน ูู API
- [x] ุงูุชุฑุชูุจ ุตุญูุญ (ูุดุทุฉ ุฃููุงู)
- [x] ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู ุงูุฃููู
- [x] ุงูุฃุณูุงุก ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุณููุงุฑูู 2: ุจุนุฏ ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช
- [x] ุฅุถุงูุฉ ุทุฑููุฉ ุฌุฏูุฏุฉ โ ุชุธูุฑ ูู ุงููุงุชูุฑุฉ ุงูุชุงููุฉ
- [x] ุชุนุฏูู ุงูุชุฑุชูุจ โ ููุนูุณ ูู ุงููุงุชูุฑุฉ
- [x] ุชุนุทูู ุทุฑููุฉ โ ุชุฎุชูู ูู ุงููุงุชูุฑุฉ
- [x] ุชุนุฏูู ุงูุงุณู โ ูุชุญุฏุซ ูู ุงููุงุชูุฑุฉ

### ุงูุณููุงุฑูู 3: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- [x] ูุดู ุงูุงุชุตุงู โ ููู ุงูุชุฑุงุถูุฉ
- [x] ูุงุฆูุฉ ูุงุฑุบุฉ โ ููู ุงุญุชูุงุทูุฉ
- [x] ุฎุทุฃ ูู ุงูุจูุงูุงุช โ ูุง ุชุนุทู

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุชุญููู **ุงุชุณุงู 100%** ุจูู ุดุงุดุฉ ุฅุนุฏุงุฏุงุช ุทุฑู ุงูุฏูุน ูุดุงุดุฉ ูุงุชูุฑุฉ ุงููุจูุนุงุช:

โ **ููุณ ุงูุชุฑุชูุจ**: ุงููุดุทุฉ ุฃููุงู ุซู ุญุณุจ display_order  
โ **ููุณ ุงููุตุฏุฑ**: API ูุงุญุฏ ููุญุฏ  
โ **ููุณ ุงูุจูุงูุงุช**: ุงูุฃุณูุงุก ูุงูุฃููุงุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช  
โ **ุชุญุฏูุซ ุชููุงุฆู**: ุฃู ุชุนุฏูู ูู ุงูุฅุนุฏุงุฏุงุช ููุนูุณ ูุจุงุดุฑุฉ  

**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู  
**ุงูุฃุฎุทุงุก:** 0 (ููุท ุชุญุฐูุฑ ุนู ุฏุงูุฉ ุบูุฑ ูุณุชุฎุฏูุฉ)  
**ุชุฌุฑุจุฉ ุงููุณุชุฎุฏุงู:** โญโญโญโญโญ ูุชุณูุฉ ูุณูุณุฉ

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 16 ุฃูุชูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ููุน ุงูุชุญุฏูุซ:** ุชุญุณูู ุงูุงุชุณุงู ูุงูุชูุงูู  
**ุงููููุงุช ุงููุนุฏูุฉ:** `add_invoice_screen.dart`
