# ุชูุฑูุฑ ุงูุชูุฏู - ุงููููุฏ ุงููุญุงุณุจูุฉ ููููุงุชูุฑ

**ุงูุชุงุฑูุฎ:** 10 ุฃูุชูุจุฑ 2025  
**ุงููุฑุญูุฉ:** Backend - ุงููููุฏ ุงููุญุงุณุจูุฉ

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### ุชุญุฏูุซ ููุทู ุงููููุฏ ุงููุญุงุณุจูุฉ (ููุชูู โ)

ุชู ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุงููุฉ ูููุทู ุฅูุดุงุก ุงููููุฏ ุงูููููุฉ ูุฏุนู **6 ุฃููุงุน ูู ุงูููุงุชูุฑ** ุจุดูู ุตุญูุญ ููููุตู.

---

## ๐ ุงููููุฏ ุงููุญุงุณุจูุฉ ููู ููุน ูุงุชูุฑุฉ

### 1๏ธโฃ ูุงุชูุฑุฉ ุจูุน (`'ุจูุน'`)

**ุงููุตู:** ุจูุน ุฐูุจ ุฌุฏูุฏ ููุนููู

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ูู ุญู/ ุงูุนููู (ุฃู ุงูุตูุฏูู)    10,000    [ูุฏูู] โ
    ุฅูู ุญู/ ุงููุฎุฒูู - ุฐูุจ       8,000    [ุฏุงุฆู] โ
    ุฅูู ุญู/ ุงูุฅูุฑุงุฏุงุช            2,000    [ุฏุงุฆู] โ
```

**ุงูููุฏ:**
```python
if invoice_type == 'ุจูุน':
    # Line 1: ูุฏูู ุงูุนููู/ุงูุตูุฏูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=party_account.id,
        cash_debit=total_cash,
        **gold_debit_fields
    ))
    
    # Line 2: ุฏุงุฆู ุงููุฎุฒูู (80% ุชูููุฉ)
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=inventory_account.id,
        cash_credit=total_cash * 0.8,
        **gold_credit_fields
    ))
    
    # Line 3: ุฏุงุฆู ุงูุฅูุฑุงุฏุงุช (20% ุฑุจุญ)
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=revenue_account.id,
        cash_credit=total_cash * 0.2
    ))
```

---

### 2๏ธโฃ ุดุฑุงุก ูุณุฑ ูู ุนููู (`'ุดุฑุงุก ูู ุนููู'`)

**ุงููุตู:** ุดุฑุงุก ุฐูุจ ูุณุชุนูู/ูุณุฑ ูู ุงูุนููู

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ูู ุญู/ ุงููุฎุฒูู - ูุณุฑ ุฐูุจ      5,000    [ูุฏูู] โ
    ุฅูู ุญู/ ุงูุนููู (ุฃู ุงูุตูุฏูู) 5,000    [ุฏุงุฆู] โ
```

**ุงูููุฏ:**
```python
elif invoice_type == 'ุดุฑุงุก ูู ุนููู':
    # Line 1: ูุฏูู ุงููุฎุฒูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=inventory_account.id,
        cash_debit=total_cash,
        **gold_debit_fields
    ))
    
    # Line 2: ุฏุงุฆู ุงูุนููู/ุงูุตูุฏูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=party_account.id,
        cash_credit=total_cash,
        **gold_credit_fields
    ))
```

---

### 3๏ธโฃ ูุฑุชุฌุน ุจูุน (`'ูุฑุชุฌุน ุจูุน'`)

**ุงููุตู:** ุงูุนููู ูุฑุฌุน ุฐูุจ ูุดุชุฑู ูููุญู (ุนูุณ ููุฏ ุงูุจูุน)

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ูู ุญู/ ุงููุฎุฒูู - ุฐูุจ          8,000    [ูุฏูู] โ
ูู ุญู/ ุงูุฅูุฑุงุฏุงุช (ุนูุณ ุงูููุฏ)   2,000    [ูุฏูู] โ
    ุฅูู ุญู/ ุงูุนููู (ุฃู ุงูุตูุฏูู) 10,000   [ุฏุงุฆู] โ
```

**ุงูููุฏ:**
```python
elif invoice_type == 'ูุฑุชุฌุน ุจูุน':
    # Line 1: ูุฏูู ุงููุฎุฒูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=inventory_account.id,
        cash_debit=total_cash * 0.8,
        **gold_debit_fields
    ))
    
    # Line 2: ูุฏูู ุงูุฅูุฑุงุฏุงุช (ุนูุณ ุงูููุฏ)
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=revenue_account.id,
        cash_debit=total_cash * 0.2
    ))
    
    # Line 3: ุฏุงุฆู ุงูุนููู/ุงูุตูุฏูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=party_account.id,
        cash_credit=total_cash,
        **gold_credit_fields
    ))
```

---

### 4๏ธโฃ ูุฑุชุฌุน ุดุฑุงุก ูุณุฑ (`'ูุฑุชุฌุน ุดุฑุงุก'`)

**ุงููุตู:** ุงููุญู ูุฑุฌุน ุงููุณุฑ ููุนููู (ุนูุณ ููุฏ ุงูุดุฑุงุก ูู ุนููู)

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ูู ุญู/ ุงูุนููู (ุฃู ุงูุตูุฏูู)     5,000    [ูุฏูู] โ
    ุฅูู ุญู/ ุงููุฎุฒูู - ูุณุฑ ุฐูุจ   5,000    [ุฏุงุฆู] โ
```

**ุงูููุฏ:**
```python
elif invoice_type == 'ูุฑุชุฌุน ุดุฑุงุก':
    # Line 1: ูุฏูู ุงูุนููู/ุงูุตูุฏูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=party_account.id,
        cash_debit=total_cash,
        **gold_debit_fields
    ))
    
    # Line 2: ุฏุงุฆู ุงููุฎุฒูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=inventory_account.id,
        cash_credit=total_cash,
        **gold_credit_fields
    ))
```

---

### 5๏ธโฃ ุดุฑุงุก (`'ุดุฑุงุก'`)

**ุงููุตู:** ุดุฑุงุก ุฐูุจ ุฌุฏูุฏ ูู ุงูููุฑุฏ

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ูู ุญู/ ุงููุฎุฒูู - ุฐูุจ         50,000    [ูุฏูู] โ
    ุฅูู ุญู/ ุงูููุฑุฏ (ุฃู ุงูุตูุฏูู) 50,000    [ุฏุงุฆู] โ
```

**ุงูููุฏ:**
```python
elif invoice_type == 'ุดุฑุงุก':
    # Line 1: ูุฏูู ุงููุฎุฒูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=inventory_account.id,
        cash_debit=total_cash,
        **gold_debit_fields
    ))
    
    # Line 2: ุฏุงุฆู ุงูููุฑุฏ/ุงูุตูุฏูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=party_account.id,
        cash_credit=total_cash,
        **gold_credit_fields
    ))
```

---

### 6๏ธโฃ ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ) (`'ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ)'`)

**ุงููุตู:** ุงููุญู ูุฑุฌุน ุฐูุจ ููููุฑุฏ (ุนูุณ ููุฏ ุงูุดุฑุงุก)

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ูู ุญู/ ุงูููุฑุฏ (ุฃู ุงูุตูุฏูู)     50,000    [ูุฏูู] โ
    ุฅูู ุญู/ ุงููุฎุฒูู - ุฐูุจ       50,000    [ุฏุงุฆู] โ
```

**ุงูููุฏ:**
```python
elif invoice_type == 'ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ)':
    # Line 1: ูุฏูู ุงูููุฑุฏ/ุงูุตูุฏูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=party_account.id,
        cash_debit=total_cash,
        **gold_debit_fields
    ))
    
    # Line 2: ุฏุงุฆู ุงููุฎุฒูู
    db.session.add(JournalEntryLine(
        journal_entry_id=journal_entry.id,
        account_id=inventory_account.id,
        cash_credit=total_cash,
        **gold_credit_fields
    ))
```

---

## ๐ ุงูุชุญุณููุงุช ุงููุถุงูุฉ

### 1. **ุชุญุฏูุฏ ุงูุญุณุงุจุงุช ุชููุงุฆูุงู**

```python
# ุงูุญุณุงุจุงุช ุงูุฃุณุงุณูุฉ
cash_account = Account.query.filter_by(name='ุงูุตูุฏูู').first()
inventory_account = Account.query.filter_by(name='ุงููุฎุฒูู').first()
sales_account = Account.query.filter(Account.name.like('ูุจูุนุงุช%')).first()
revenue_account = Account.query.filter(Account.name.like('ุงูุฅูุฑุงุฏุงุช%')).first()
purchases_account = Account.query.filter_by(name='ุงููุดุชุฑูุงุช').first()

# ุญุณุงุจ ุงูุทุฑู (ุนููู ุฃู ููุฑุฏ)
if new_invoice.customer_id:
    customer = Customer.query.get(new_invoice.customer_id)
    party_account = Account.query.get(customer.account_id)
elif new_invoice.supplier_id:
    supplier = Supplier.query.get(new_invoice.supplier_id)
    party_account = Account.query.get(supplier.account_id)
else:
    party_account = cash_account  # Default
```

### 2. **ูุตู ูุญุณูู ูููููุฏ**

```python
journal_desc = f"ูุงุชูุฑุฉ {invoice_type} ุฑูู #{new_invoice.invoice_type_id}"
if new_invoice.original_invoice_id:
    journal_desc += f" (ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉ #{new_invoice.original_invoice_id})"
```

**ูุซุงู:**
- `"ูุงุชูุฑุฉ ุจูุน ุฑูู #123"`
- `"ูุงุชูุฑุฉ ูุฑุชุฌุน ุจูุน ุฑูู #45 (ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉ #123)"`

### 3. **ุฏุนู ุงูุฐูุจ ุจุงูุฃุนูุฑุฉ ุงููุฎุชููุฉ**

```python
# ุชุญุถูุฑ ุญููู ุงูุฐูุจ
gold_debit_fields = {f"debit_{k}k": v for k, v in gold_by_karat.items() if v > 0}
gold_credit_fields = {f"credit_{k}k": v for k, v in gold_by_karat.items() if v > 0}

# ูุซุงู: ุฅุฐุง ูุงู ูุฏููุง 10 ุฌุฑุงู ุนูุงุฑ 21
# gold_debit_fields = {"debit_21k": 10.0}
# gold_credit_fields = {"credit_21k": 10.0}
```

---

## ๐ ุฌุฏูู ููุงุฑูุฉ ุงููููุฏ

| ุงูููุน | ูู ุญู/ (ูุฏูู) | ุฅูู ุญู/ (ุฏุงุฆู) | ุงูุฃุซุฑ ุนูู ุงูุฃุฑุตุฏุฉ |
|-------|---------------|----------------|-------------------|
| **ุจูุน** | ุงูุนููู/ุงูุตูุฏูู | ุงููุฎุฒูู + ุงูุฅูุฑุงุฏุงุช | โฌ๏ธ ุงูุนูููุ โฌ๏ธ ุงููุฎุฒููุ โฌ๏ธ ุงูุฅูุฑุงุฏุงุช |
| **ุดุฑุงุก ูู ุนููู** | ุงููุฎุฒูู | ุงูุนููู/ุงูุตูุฏูู | โฌ๏ธ ุงููุฎุฒููุ โฌ๏ธ ุงูุนููู |
| **ูุฑุชุฌุน ุจูุน** | ุงููุฎุฒูู + ุงูุฅูุฑุงุฏุงุช | ุงูุนููู/ุงูุตูุฏูู | โฌ๏ธ ุงููุฎุฒููุ โฌ๏ธ ุงูุฅูุฑุงุฏุงุชุ โฌ๏ธ ุงูุนููู |
| **ูุฑุชุฌุน ุดุฑุงุก** | ุงูุนููู/ุงูุตูุฏูู | ุงููุฎุฒูู | โฌ๏ธ ุงููุฎุฒููุ โฌ๏ธ ุงูุนููู |
| **ุดุฑุงุก** | ุงููุฎุฒูู | ุงูููุฑุฏ/ุงูุตูุฏูู | โฌ๏ธ ุงููุฎุฒููุ โฌ๏ธ ุงูููุฑุฏ |
| **ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ)** | ุงูููุฑุฏ/ุงูุตูุฏูู | ุงููุฎุฒูู | โฌ๏ธ ุงููุฎุฒููุ โฌ๏ธ ุงูููุฑุฏ |

---

## โ ุงูููุงุนุฏ ุงููุญุงุณุจูุฉ ุงููุทุจูุฉ

### 1. **ุงูุชูุงุฒู (Balanced Entries)**
- โ ุฅุฌูุงูู ุงููุฏูู = ุฅุฌูุงูู ุงูุฏุงุฆู ูู ูู ููุฏ
- โ ุงูุชูุงุฒู ูุดูู ุงูููุฏ ูุงูุฐูุจ

### 2. **ุงููุฑุชุฌุนุงุช (Returns)**
- โ ูููุฏ ุงููุฑุชุฌุนุงุช ูู **ุนูุณ** ุงููููุฏ ุงูุฃุตููุฉ
- โ ุงูุฑุจุท ุจุงููุงุชูุฑุฉ ุงูุฃุตููุฉ ุนุจุฑ `original_invoice_id`

### 3. **ุงูุฃุทุฑุงู (Parties)**
- โ ุฅุฐุง ูุงู ููุงู ุนููู/ููุฑุฏ โ ุงุณุชุฎุฏุงู ุญุณุงุจู
- โ ุฅุฐุง ูุงู ููุฏู โ ุงุณุชุฎุฏุงู ุญุณุงุจ ุงูุตูุฏูู

### 4. **ุงููุฎุฒูู (Inventory)**
- โ ุงูุจูุน ูุฎูุถ ุงููุฎุฒูู
- โ ุงูุดุฑุงุก ูุฒูุฏ ุงููุฎุฒูู
- โ ูุฑุชุฌุน ุงูุจูุน ูุฒูุฏ ุงููุฎุฒูู
- โ ูุฑุชุฌุน ุงูุดุฑุงุก ูุฎูุถ ุงููุฎุฒูู

---

## ๐ฏ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุจูุน ุฐูุจ ููุฏู

```json
POST /api/invoices
{
  "invoice_type": "ุจูุน",
  "customer_id": null,  // ููุฏู
  "date": "2025-10-10",
  "total": 10000,
  "items": [{"karat": 21, "weight": 50, ...}]
}
```

**ุงูููุฏ ุงููุงุชุฌ:**
```
ูู ุญู/ ุงูุตูุฏูู          10,000  [ูุฏูู]
                        50g 21k  [ูุฏูู]
    ุฅูู ุญู/ ุงููุฎุฒูู      8,000  [ุฏุงุฆู]
                        50g 21k  [ุฏุงุฆู]
    ุฅูู ุญู/ ุงูุฅูุฑุงุฏุงุช    2,000  [ุฏุงุฆู]
```

---

### ูุซุงู 2: ูุฑุชุฌุน ุจูุน

```json
POST /api/invoices
{
  "invoice_type": "ูุฑุชุฌุน ุจูุน",
  "customer_id": 5,
  "original_invoice_id": 123,
  "return_reason": "ุนูุจ ูู ุงูุตูุนุฉ",
  "date": "2025-10-15",
  "total": 10000,
  "items": [{"karat": 21, "weight": 50, ...}]
}
```

**ุงูููุฏ ุงููุงุชุฌ (ุนูุณ ุงูุจูุน):**
```
ูู ุญู/ ุงููุฎุฒูู         8,000  [ูุฏูู]
                       50g 21k  [ูุฏูู]
ูู ุญู/ ุงูุฅูุฑุงุฏุงุช       2,000  [ูุฏูู]
    ุฅูู ุญู/ ุงูุนููู    10,000  [ุฏุงุฆู]
                       50g 21k  [ุฏุงุฆู]
```

---

## ๐ ุงูุชุญูู ูุงูุงุฎุชุจุงุฑ

### ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ:

- [ ] ุงุฎุชุจุงุฑ ูุงุชูุฑุฉ ุจูุน ููุฏู
- [ ] ุงุฎุชุจุงุฑ ูุงุชูุฑุฉ ุจูุน ุขุฌู (ุจุนููู)
- [ ] ุงุฎุชุจุงุฑ ุดุฑุงุก ูุณุฑ ูู ุนููู
- [ ] ุงุฎุชุจุงุฑ ูุฑุชุฌุน ุจูุน (ูุน ูุงุชูุฑุฉ ุฃุตููุฉ)
- [ ] ุงุฎุชุจุงุฑ ูุฑุชุฌุน ุดุฑุงุก ูุณุฑ
- [ ] ุงุฎุชุจุงุฑ ุดุฑุงุก
- [ ] ุงุฎุชุจุงุฑ ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ)
- [ ] ุงูุชุญูู ูู ุชูุงุฒู ุงููููุฏ
- [ ] ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ

---

## ๐ ุงูุชูุฏู ุงูุฅุฌูุงูู

```
โ Models                  100%
โ Migration              100%
โ API Endpoints          100%
โ ุงููููุฏ ุงููุญุงุณุจูุฉ      100%
โณ Frontend POS            0%
โณ Frontend Accounting     0%
โณ ุดุงุดุงุช ุงููุฑุชุฌุนุงุช        0%
โณ ุงูุงุฎุชุจุงุฑ ูุงูุชูุซูู      0%

ุงูุฅุฌูุงูู: 4/8 = 50% โจ
```

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ

### ุงููุฑุญูุฉ ุงููุงุฏูุฉ: Frontend

#### 1. **ุชุญุฏูุซ ูุณู ููุงุท ุงูุจูุน (POS)**
- ุดุงุดุฉ ูุงุชูุฑุฉ ุจูุน
- ุดุงุดุฉ ุดุฑุงุก ูุณุฑ ูู ุนููู
- ุดุงุดุฉ ูุฑุชุฌุน ุจูุน
- ุดุงุดุฉ ูุฑุชุฌุน ุดุฑุงุก ูุณุฑ

#### 2. **ุชุญุฏูุซ ูุณู ุงููุญุงุณุจุฉ**
- ุดุงุดุฉ ุดุฑุงุก
- ุดุงุดุฉ ูุฑุชุฌุน ุดุฑุงุก (ููุฑุฏ)
- ุชุญุณูู ุนุฑุถ ุงููููุฏ ุงูููููุฉ

#### 3. **ุดุงุดุงุช ุงููุฑุชุฌุนุงุช**
- ุงุฎุชูุงุฑ ูุงุชูุฑุฉ ุฃุตููุฉ
- ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ
- ุชุญุฏูุฏ ุงูุฃุตูุงู ุงููุฑุชุฌุนุฉ
- ุฅุฏุฎุงู ุณุจุจ ุงูุฅุฑุฌุงุน

---

**ุงูุญุงูุฉ:** ๐ข Backend ูุงูู 100%  
**ุฌุงูุฒ ููุงูุชูุงู ุฅูู:** Frontend Development
