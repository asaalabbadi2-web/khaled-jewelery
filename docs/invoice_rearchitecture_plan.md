# ุฎุทุฉ ุฅุนุงุฏุฉ ููููุฉ ููุงุชูุฑ ุงูุฐูุจ (ุดุฑุงุก/ุจูุน ูุณุฑ)

## ๐ฏ ุงูุฃูุฏุงู
- ุฅุถุงูุฉ **ูุงุชูุฑุฉ ุจูุน ูุณุฑ** ูุฎุตุตุฉ ุชุฏุนู ุงููููุฉ ุงูุฅูุฒุงููุฉ ูุชุตููุฑ ุงูุถุฑูุจุฉ.
- ุฅุนุงุฏุฉ ุชุตููู **ูุงุชูุฑุฉ ุดุฑุงุก ุงููุณุฑ** ู **ูุงุชูุฑุฉ ุดุฑุงุก ุงูุฐูุจ ุงูุฌุฏูุฏ** ูุชุชูุงุดู ูุน ููุทู ุงููุฒู ูุงูุฐูุจ ููุงุจู ุงูุฐูุจ.
- ุชูุญูุฏ ููุทู ุงูููุงุชูุฑ ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุงูุฎูููุฉ ุญูู ูููุฐุฌ ุจูุงูุงุช ูุงุญุฏ ูุงุฎุชุจุงุฑุงุช ูุงุถุญุฉ.

## ๐งพ ูุชุทูุจุงุช ุงูุนูู ุงููุณุชุฎูุตุฉ
- ุงูุชุณุฌูู ุจุงููููุฉ ุงููุทููุฉ (ุฑูู ุงููููุฉ + ุชุงุฑูุฎ ุงููููุงุฏ/ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ) ุฅูุฒุงูู ููู ูุนุงููุฉ ูุณุฑ.
- ุงูุตููุงุช ูู ููุน "ูุณุฑ" ูุง ุชุชุถูู ุถุฑูุจุฉ ูููุฉ ูุถุงูุฉุ ููุฌุจ ุฃู ุชุนุชูุฏ ุนูู **ูุฒู ุงูุฐูุจ** ุจุงููุงูู.
- ุชุณููุฉ ุงููุณุฑ ุชุชู ุนุจุฑ **ุฐูุจ ููุงุจู ุฐูุจ** (ุชุณุฌูู ุงููุฒู ุงููุฏููุนุ ุงูุนูุงุฑุ ููุฑููุงุช ุงูุฃุฌุฑุฉ).
- ูุงุชูุฑุฉ ุดุฑุงุก ุงูุฐูุจ ุงูุฌุฏูุฏ ูู ุงูููุฑุฏูู ุชุธู ููุฏูุฉ ูููู ูุฌุจ ุฃู ุชุณุชููุฏ ูู ููุณ ุงูุจููุฉ ุงูููุญุฏุฉ.
- ูุงุฌูุงุช ุงููุณุชุฎุฏู ูุฌุจ ุฃู ุชุนุฑุถ ุชุญุฐูุฑุงุช ูุงุถุญุฉ ุนูุฏ ุบูุงุจ ุจูุงูุงุช ุงููููุฉ ุฃู ุชุฌุงูุฒ ุงูุญุฏูุฏ ุงูููุจููุฉ ูููุฒู.

> **ุงูุชุฑุงุถุงู ุนูููุงู** (ูุญุชุงุฌ ุชุฃููุฏ ูุงุญูุงู):
> 1. ุจูุน ุงููุณุฑ ูุชู ูู ูุฎุฒูู ุงููุณุฑ ุฏุงุฎู ุงููุธุงูุ ูููุณ ุนุจุฑ ุฃุตูุงู ูุณุฌูุฉ ูุณุจูุงู.
> 2. ุชุณููุฉ ุงูุฃุฌุฑุฉ ูู ุนูููุงุช ุดุฑุงุก ุงููุณุฑ ูููู ุฃู ุชุชู ุจุงูุฐูุจ ุฃู ุจุงูููุฏ ูููู ูุฌุจ ุชุฏููู ุงูุฎูุงุฑ ุตุฑุงุญุฉู.

## ๐งฑ ุงูุชุตููู ุงููุนูุงุฑู ุงูููุชุฑุญ

### 1. ุทุจูุฉ ุงูููุงุฐุฌ (Frontend)
- ุงุณุชุฎุฏุงู ุงููููุฐุฌ ุงูููุญุฏ `InvoiceItemRow` ุงูููุฌูุฏ ูู `lib/features/invoice/models/` ูุฌููุน ุฃููุงุน ุงูููุงุชูุฑ.
- ุฅุถุงูุฉ `InvoiceFormState` ุฌุฏูุฏ ูุฏูุฑ:
  - ูุงุฆูุฉ ุงูุฃุตูุงู (List<InvoiceItemRow>)
  - ุฅุนุฏุงุฏุงุช ุงูุฐูุจ (ุณุนุฑ 24ุ ุงูุนูุงุฑ ุงูุฑุฆูุณูุ ูุนุงูู ุงูุชุญููู)
  - ูุนูููุงุช ุงูุทุฑู (ุนููู/ููุฑุฏ) ููููุฉ ุงูุนููู
  - ุจูุงูุงุช ุงูุชุณููุฉ (ุฐูุจ ูุฏููุนุ ูุฑูู ุฃุฌุฑุฉุ ููุงุญุธุงุช)
- ุชูููุฑ `InvoiceFlowConfig` ูุนุฑูุฉ ุจุงูู enums ูุชุญุฏูุฏ ุณููู ูู ููุน:
  - `SaleNew`, `SaleScrap`, `PurchaseScrapCustomer`, `PurchaseNewSupplier`
  - ููู ููุน: ุฎุทูุงุช ุงููStepper ุงูููุนูุฉุ ุงูุญููู ุงูุฅูุฒุงููุฉุ ุงูุณูุงุญ ุจุงูุถุฑูุจุฉ ุฃู ููุนูุงุ ุฎูุงุฑุงุช ุงูุฏูุน.

### 2. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ (Frontend)
- ุฅูุดุงุก ูุฒูุฏ (ChangeNotifier ุฃู Riverpod) ูู `lib/features/invoice/providers/`:
  - `InvoiceFormController` ููููุฑ ุนูููุงุช ุฅุถุงูุฉ/ุชุญุฏูุซ ุฃุตูุงูุ ุญุณุงุจ ุงูุฅุฌูุงููุงุชุ ูุถุจุท ุญุงูุฉ ุงููููุฉ.
  - ูุฏุนู ุขููุฉ `validateBeforeSubmit` ุงูุชู ุชุชุญูู ูู:
    - ูุฌูุฏ ุนููู/ููุฑุฏ.
    - ุงูุชูุงู ุจูุงูุงุช ุงููููุฉ ููุนููู ูู ูุนุงููุงุช ุงููุณุฑ.
    - ุฃู ุฅุฌูุงูู ุงููุฒู > 0.
    - ุชูุงูู ุงูุฐูุจ ุงููุฏููุน ูุน ุงููุฑููุงุช (ุฎุงุตุฉ ูู ุงูุดุฑุงุก ูู ุนููู).

### 3. ุงููุงุฌูุงุช (Frontend)
- ุจูุงุก ูุงุฌูุฉ ููุงุณูุฉ ุชุนุชูุฏ ูููููุงุช ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู:
  - `PartySelectionStep` (ุนููู/ููุฑุฏ + ูููุฉ).
  - `ItemsEntryStep` ูุน ุฏุนู ุฅุฏุฎุงู ูุฏูู ูุฃุฒุฑุงุฑ ูุณุงุนุฏุฉ ูุถุจุท ุงูุนูุงุฑ.
  - `SettlementStep` ูุนูููุงุช ุงููุณุฑ (ูุฒู ุฐูุจ ูุฏููุนุ ูุฑููุงุช ุฃุฌุฑุฉ).
  - `PaymentStep` ููุนูููุงุช ุงูููุฏูุฉ (ุดุฑุงุก ุฌุฏูุฏ ูู ููุฑุฏ).
  - `ReviewStep` ูุนุฑุถ ููุฎุต ูููุงุฆู ูุจู ุงูุญูุธ.

#### ุดุงุดุงุช ุฌุฏูุฏุฉ/ูุญุฏูุซุฉ
| ุดุงุดุฉ | ุงูุฅุฌุฑุงุก | ููุงุญุธุงุช |
|-------|---------|---------|
| `ScrapSalesInvoiceScreen` | ุจูุน ูุณุฑ | ุชุนุชูุฏ ุนูู `SaleScrap` configุ ุจุฏูู ุถุฑูุจุฉุ ุชูุฑุถ ูููุฉ ุงูุนููู. |
| `ScrapPurchaseInvoiceScreen` | ุดุฑุงุก ูุณุฑ ูู ุนููู | ุชุณุชุฎุฏู SettlementStep ูุชููุน ุงูุถุฑูุจุฉ. |
| `SupplierPurchaseInvoiceScreen` | ุดุฑุงุก ุฐูุจ ุฌุฏูุฏ ูู ููุฑุฏ | ุชุณูุญ ุจุงูุถุฑูุจุฉ ุฅู ูุฌุฏุช ูุชุณูุญ ุจูุณุงุฆู ุฏูุน ููุฏูุฉ ูุชุนุฏุฏุฉ. |
| `SalesInvoiceScreenV2` | (ุชุญุฏูุซ) | ุฅุถุงูุฉ ุฎูุงุฑ ุงุฎุชูุงุฑ ููุน ุงูุฐูุจ (new/scrap) ูุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุทู ูุณุชูุจูุงู. |

### 4. ุฑุจุท ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ
- ุชุญุฏูุซ `home_screen_enhanced.dart` ูุฅุถุงูุฉ ูุฏุฎู ูุณุชูู ูู "ูุงุชูุฑุฉ ุจูุน ูุณุฑ".
- ุฅุนุงุฏุฉ ุชูุฌูู ุฑูุงุจุท "ุดุฑุงุก ูุณุฑ" ู"ุดุฑุงุก" ุฅูู ุงูุดุงุดุงุช ุงูุฌุฏูุฏุฉ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุจูุงุก.

## ๐๏ธ ุงูุชุนุฏููุงุช ุงููุทููุจุฉ ูู ุงูู Backend

### 1. ูุณุงุฑ `/api/invoices`
- ูุฑุงุกุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ ูู ุงูุทูุจุงุช ูุชุฎุฒูููุง:
  - `payment_gold_weight`, `payment_gold_karat`, `wage_payment_method`, `net_gold_difference_21k`, `total_wage`, `wage_in_gold_21k`, `settled_gold_weight`, `settled_wage_amount`.
- ุนูุฏูุง ูููู `gold_type == 'scrap'`:
  - ุชุนุทูู ุญุณุงุจ ุงูุถุฑูุจุฉ (`total_tax = 0`).
  - ุงุณุชุฎุฏุงู ุญุณุงุจุงุช ูุญุงุณุจูุฉ ุฎุงุตุฉ (ูุซู `sales_gold_scrap`, `inventory_scrap`).
  - ุชุณุฌูู ุงูุฃูุฒุงู ูู ูููุฏ ุงูููููุฉ ุนูุฏ ุงูุชุณููุฉ ุจุงูุฐูุจ.

### 2. ุฑุจุท ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ
- ุฅุถุงูุฉ ููุงุชูุญ ุงูุชุฑุงุถูุฉ ุฌุฏูุฏุฉ ูู `get_account_id_for_mapping`:
  - `sales_gold_scrap`
  - `inventory_scrap`
  - `scrap_customers` (ุฅุฐุง ุชุทูุจ ุงูุฃูุฑ ุญุณุงุจ ูููุตู)
- ุชุญุฏูุซ ุฃุฏุงุฉ ุฅุนุฏุงุฏุงุช ุงูุฑุจุท (Accounting Mapping) ูุฅุชุงุญุฉ ูุฐู ุงูููุงุชูุญ ูููุณุชุฎุฏู.

### 3. ุงูุชุญูู ูู ุงููููุฉ
- ุฅุถุงูุฉ ุชุญูู ุงุฎุชูุงุฑู ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ูุณุฑ:
  - ุฅุฐุง ูุงู `invoice_type` ูุชุนูู ุจุนููู ู`gold_type='scrap'`, ุงูุชุฃูุฏ ูู ุฃู `customer.id_number` ุบูุฑ ูุงุฑุบ ูุฅุฑุฌุงุน ุฎุทุฃ ูุงุถุญ ุฅุฐุง ูุงู ูุงุฑุบุงู.

### 4. ุงุฎุชุจุงุฑุงุช ูุญุฏุงุช/ุชูุงูู
- ุชุญุฏูุซ `test_invoices.py` ูุฅุถุงูุฉ:
  - ุงุฎุชุจุงุฑ ูุงุชูุฑุฉ ุจูุน ูุณุฑ.
  - ุงุฎุชุจุงุฑ ุดุฑุงุก ูุณุฑ ูุน ุชุณููุฉ ุฐูุจูุฉ.
  - ุชุฃููุฏ ุชุณุฌูู ุงูุญููู ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

## ๐งช ุณููุงุฑูููุงุช ููููุฏ
- **ุงููููุฉ ูุงูุตุฉ:** ุฅุธูุงุฑ ุฑุณุงูุฉ ุชููุน ุงูุชูุฏู ูุน ุฒุฑ ุงุฎุชุตุงุฑ ููุชุญ ูุงูุฐุฉ ุชุนุฏูู ุจูุงูุงุช ุงูุนููู.
- **ูุฒู ุงูุตุงูู ุตูุฑ/ุณุงูุจ:** ููุน ุงูุญูุธ ูุงูุชูุจูู ูููุณุชุฎุฏู.
- **ุงูุชุณููุฉ ุจุงูุฐูุจ > ุงููุฒู ุงููุดุชูุฑู:** ุชุญุฐูุฑ ุงููุณุชุฎุฏู ูุงูุณูุงุญ ููุท ุจุนุฏ ุชุฃููุฏ (ุฃู ููุน ุญุณุจ ุณูุงุณุฉ ุงูุนูู).
- **ูุฑููุงุช ุงูุฃุฌุฑุฉ:** ุฅุฐุง ุชู ุงุฎุชูุงุฑ ุชุณููุฉ ุงูุฃุฌุฑุฉ ุฐูุจุงูุ ุชุญููู ุงููููุฉ ุชููุงุฆูุงู ุฅูู ุฌุฑุงู 21 ุจุงุณุชุฎุฏุงู ุณุนุฑ ุงูุฐูุจ ุงูุญุงูู.
- **ุนุฏู ุชููุฑ ุณุนุฑ ุฐูุจ ูุญุฏุซ:** ุงูุณูุงุญ ุจุงูุฅุฏุฎุงู ุงููุฏูู ูุณุนุฑ 24K ูุน ุชุญุฐูุฑ.

## ๐ฆ ุฎุทุฉ ุงูุงุฎุชุจุงุฑ ูุงูุชุญูู
1. **Frontend**
   - ุชุดุบูู `flutter analyze` ุจุนุฏ ูู ุชุนุฏูู.
   - ุฅุถุงูุฉ ูุฌููุนุฉ ุงุฎุชุจุงุฑุงุช ูุญุฏุงุช ุจุณูุทุฉ ููุฒูุฏ ุงูุญุงูุฉ (ุญุณุงุจุงุช ุงููุฒู/ุงูุฅุฌูุงูู).
2. **Backend**
   - ุชุดุบูู `pytest` ุฃู ุณูุฑุจุช ุงูุงุฎุชุจุงุฑุงุช ุงูุญุงูู ุจุนุฏ ุชุนุฏูู ุงููุณุงุฑ.
   - ุงูุชุญูู ูู ุฃู ูููุฏ ุงูููููุฉ ูุชุฒูุฉ ุนุจุฑ `verify_dual_balance`.
3. **ุชูุงูู ูุฏูู**
   - ุฅูุดุงุก ุนููู ุจุฏูู ูููุฉ โ ูุญุงููุฉ ุฅุตุฏุงุฑ ูุงุชูุฑุฉ ูุณุฑ โ ุงูุชุฃูุฏ ูู ุธููุฑ ุงูููุน.
   - ุณููุงุฑูู ุฏูุน ุงูุฐูุจ: ูุฒู ูุดุชูุฑู 100 ุฌูุ ุงููุชุฌุฑ ูุณูู 90 ุฌูุ ูุชู ุชุณุฌูู ุงููุชุจูู 10 ุฌู ูุฑุตูุฏ.
   - ุณููุงุฑูู ุดุฑุงุก ุฌุฏูุฏ ูู ููุฑุฏ ูุน ุถุฑูุจุฉ ููุชุฃูุฏ ุฃู ุงูุญุณุงุจ ุงููุฏูู ูู ูุชุฃุซุฑ.

## ๐ ุฎุทูุงุช ุงูุชูููุฐ ุงูููุชุฑุญุฉ
1. **ุงูุจููุฉ ุงูุฃุณุงุณูุฉ (Frontend)**: ุฅูุดุงุก ุงููุฒูุฏ ูุงูู configs + ุงูุดุงุดุงุช ุงูุฌุฏูุฏุฉ ูุงุฑุบุฉ.
2. **ุชุญุฏูุซ backend** ููุชุนุงูู ูุน ุงูุญููู ุงูุฌุฏูุฏุฉ ูููุทู ุงููุณุฑ.
3. **ุจูุงุก UI ููู ุดุงุดุฉ** ุชุฏุฑูุฌูุงู ูุฑุจุทูุง ุจุงููุฒูุฏ.
4. **ุชููุฆุฉ ุงูุฑุจุท ุงููุญุงุณุจู** ููุชุฃูุฏ ูู ุญุณุงุจุงุช ุงููุณุฑ.
5. **ูุชุงุจุฉ ุงูุงุฎุชุจุงุฑุงุช** ูุชุดุบูู ุงูุชุญูููุงุช.
6. **ุชูุซูู ุงูุชุบููุฑุงุช** ูู README ูููู ุงูุชุบููุฑ ุงููุญุงุณุจู.

---

๐ก ุจูุฌุฑุฏ ุงูููุงููุฉ ุนูู ูุฐู ุงูุฎุทุฉุ ูููู ุงูุจุฏุก ุจุชูููุฐ ุงูุฎุทูุฉ ุงูุฃููู ุจุฅูุดุงุก ุงูุจููุฉ ุงูุฃุณุงุณูุฉ ููุฒูุฏ ุงูููุงุชูุฑ ุงูููุญุฏ ูุฅุนุฏุงุฏ ุงูุดุงุดุงุช ุงููุจุฏุฆูุฉ.
